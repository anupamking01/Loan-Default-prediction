<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>6232af456c2f455a9132cec07deff66f</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell code" data-execution_count="90" id="GNQp6HNQgBVL">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install utils <span class="op">--</span>quiet</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="91" id="k5DfnAZoaM3U">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install imblearn <span class="op">--</span>quiet</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="92" id="q6G2yLscxkqd">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install catboost <span class="op">--</span>quiet</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="93" id="lsqBJaP9xkgd">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install plotly <span class="op">--</span>quiet</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="93" id="uiuNQkSFkb00">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<div class="cell code" data-execution_count="94"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="-ogbjFct_sps" data-outputId="8f44d803-b0db-4453-910a-7899e561feba">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">&#39;/content/drive&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</code></pre>
</div>
</div>
<div class="cell markdown" id="VB0HdvJ5kb01">
<p>#Introduction:</p>
<p>Welcome to this data analysis project aimed at developing a robust
model for predicting loan defaults. In this endeavor, we delve into the
intricate landscape of loan applications, aiming to empower MoneyLion
with sharper risk assessment tools.</p>
<p>Imagine a scenario where a prospective borrower submits a loan
application. The process is set in motion, with meticulous scrutiny
carried out by underwriters to detect any potential fraud. Once deemed
legitimate, the application progresses to approval, culminating in the
funding of the loan.</p>
<p>Our mission is clear: to position our predictive model strategically
between the stages of fraud detection and loan approval. By doing so, we
aim to provide a crucial checkpoint, offering a nuanced evaluation of
risk that complements existing processes. We acknowledge the
effectiveness of fraud detection mechanisms in sieving out most
fraudulent applications, allowing us to focus our efforts on risk
assessment with precision and clarity.</p>
<p>Through this endeavor, we aspire to furnish lenders, such as
MoneyLion, with a discerning tool capable of gauging the risk associated
with each application. This, in turn, facilitates well-informed business
decisions, aligning with the company's risk tolerance and fostering a
culture of prudent lending practices. Join us as we navigate through
data, algorithms, and insights, charting a course toward enhanced risk
management in the realm of lending.</p>
</div>
<section id="libraries" class="cell markdown" id="ndHAQJnLkb02">
<h1>Libraries</h1>
</section>
<div class="cell code" data-execution_count="96" id="cC8ZfbUmkb02">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">&quot;ignore&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">&#39;whitegrid&#39;</span>, palette<span class="op">=</span><span class="st">&#39;pastel&#39;</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> boxcox</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, roc_curve</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> make_classification</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier, GradientBoostingClassifier, AdaBoostClassifier, StackingClassifier</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lightgbm <span class="im">import</span> LGBMClassifier</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> catboost <span class="im">import</span> CatBoostClassifier</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> <span class="op">*</span></span></code></pre></div>
</div>
<section id="exploratory-data-analysis-eda" class="cell markdown"
id="yiBEif16kb02">
<h1>Exploratory Data Analysis (EDA)</h1>
</section>
<div class="cell code" data-execution_count="97"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:313}"
id="tTqjwseIkb02" data-outputId="95b46cbc-2797-4a65-be5a-22cb439f6d36">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>loan <span class="op">=</span> pd.read_csv(<span class="st">&#39;/content/drive/MyDrive/loan-default-model/loan.csv&#39;</span>, parse_dates<span class="op">=</span>[<span class="st">&#39;applicationDate&#39;</span>, <span class="st">&#39;originatedDate&#39;</span>])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>loan.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="97">

  <div id="df-e92c2973-f195-4bdc-8935-a879966178f4" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>applicationDate</th>
      <th>originated</th>
      <th>originatedDate</th>
      <th>nPaidOff</th>
      <th>approved</th>
      <th>isFunded</th>
      <th>loanStatus</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>state</th>
      <th>leadType</th>
      <th>leadCost</th>
      <th>fpStatus</th>
      <th>clarityFraudId</th>
      <th>hasCF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LL-I-07399092</td>
      <td>beff4989be82aab4a5b47679216942fd</td>
      <td>B</td>
      <td>360.0</td>
      <td>2016-02-23 17:29:01.940</td>
      <td>False</td>
      <td>NaT</td>
      <td>0.0</td>
      <td>False</td>
      <td>0</td>
      <td>Withdrawn Application</td>
      <td>500.0</td>
      <td>978.27</td>
      <td>IL</td>
      <td>bvMandatory</td>
      <td>6</td>
      <td>NaN</td>
      <td>5669ef78e4b0c9d3936440e6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LL-I-06644937</td>
      <td>464f5d9ae4fa09ece4048d949191865c</td>
      <td>B</td>
      <td>199.0</td>
      <td>2016-01-19 22:07:36.778</td>
      <td>True</td>
      <td>2016-01-20 15:49:18.846</td>
      <td>0.0</td>
      <td>True</td>
      <td>1</td>
      <td>Paid Off Loan</td>
      <td>3000.0</td>
      <td>6395.19</td>
      <td>CA</td>
      <td>prescreen</td>
      <td>0</td>
      <td>Checked</td>
      <td>569eb3a3e4b096699f685d64</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>LL-I-10707532</td>
      <td>3c174ae9e2505a5f9ddbff9843281845</td>
      <td>B</td>
      <td>590.0</td>
      <td>2016-08-01 13:51:14.709</td>
      <td>False</td>
      <td>NaT</td>
      <td>0.0</td>
      <td>False</td>
      <td>0</td>
      <td>Withdrawn Application</td>
      <td>400.0</td>
      <td>1199.45</td>
      <td>MO</td>
      <td>bvMandatory</td>
      <td>3</td>
      <td>NaN</td>
      <td>579eab11e4b0d0502870ef2f</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>LL-I-02272596</td>
      <td>9be6f443bb97db7e95fa0c281d34da91</td>
      <td>B</td>
      <td>360.0</td>
      <td>2015-08-06 23:58:08.880</td>
      <td>False</td>
      <td>NaT</td>
      <td>0.0</td>
      <td>False</td>
      <td>0</td>
      <td>Withdrawn Application</td>
      <td>500.0</td>
      <td>1074.05</td>
      <td>IL</td>
      <td>bvMandatory</td>
      <td>3</td>
      <td>NaN</td>
      <td>555b1e95e4b0f6f11b267c18</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>LL-I-09542882</td>
      <td>63b5494f60b5c19c827c7b068443752c</td>
      <td>B</td>
      <td>590.0</td>
      <td>2016-06-05 22:31:34.304</td>
      <td>False</td>
      <td>NaT</td>
      <td>0.0</td>
      <td>False</td>
      <td>0</td>
      <td>Rejected</td>
      <td>350.0</td>
      <td>814.37</td>
      <td>NV</td>
      <td>bvMandatory</td>
      <td>3</td>
      <td>NaN</td>
      <td>5754a91be4b0c6a2bf424772</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-e92c2973-f195-4bdc-8935-a879966178f4')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-e92c2973-f195-4bdc-8935-a879966178f4 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-e92c2973-f195-4bdc-8935-a879966178f4');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-34600801-f0c9-439f-9598-30632961499c">
  <button class="colab-df-quickchart" onclick="quickchart('df-34600801-f0c9-439f-9598-30632961499c')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-34600801-f0c9-439f-9598-30632961499c button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="98"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="Z89jxlxLAE4q" data-outputId="6b1073f3-c745-4482-d4be-85dcebcdb602">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pprint(loan.columns)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Index([&#39;loanId&#39;, &#39;anon_ssn&#39;, &#39;payFrequency&#39;, &#39;apr&#39;, &#39;applicationDate&#39;,
       &#39;originated&#39;, &#39;originatedDate&#39;, &#39;nPaidOff&#39;, &#39;approved&#39;, &#39;isFunded&#39;,
       &#39;loanStatus&#39;, &#39;loanAmount&#39;, &#39;originallyScheduledPaymentAmount&#39;, &#39;state&#39;,
       &#39;leadType&#39;, &#39;leadCost&#39;, &#39;fpStatus&#39;, &#39;clarityFraudId&#39;, &#39;hasCF&#39;],
      dtype=&#39;object&#39;)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="99"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:300}"
id="HG1LSWvQw7IG" data-outputId="39ff52a6-3b77-4ad5-b816-a6c1ab503e9d">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>loan.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="99">

  <div id="df-c693be2f-fe2a-4562-97f3-7fe9ddb16f2c" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>apr</th>
      <th>nPaidOff</th>
      <th>isFunded</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>leadCost</th>
      <th>hasCF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>573760.000000</td>
      <td>577658.000000</td>
      <td>577682.000000</td>
      <td>575432.000000</td>
      <td>577682.000000</td>
      <td>577682.000000</td>
      <td>577682.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>553.080972</td>
      <td>0.037887</td>
      <td>0.067480</td>
      <td>514.245084</td>
      <td>1428.897209</td>
      <td>7.854389</td>
      <td>0.619187</td>
    </tr>
    <tr>
      <th>std</th>
      <td>110.046159</td>
      <td>0.333366</td>
      <td>0.250852</td>
      <td>320.939929</td>
      <td>925.009141</td>
      <td>12.853451</td>
      <td>0.485587</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-816.710000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>490.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>350.000000</td>
      <td>1023.640000</td>
      <td>3.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>590.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>500.000000</td>
      <td>1245.250000</td>
      <td>3.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>601.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>500.000000</td>
      <td>1615.660000</td>
      <td>6.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>705.590000</td>
      <td>21.000000</td>
      <td>1.000000</td>
      <td>5000.000000</td>
      <td>19963.630000</td>
      <td>200.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-c693be2f-fe2a-4562-97f3-7fe9ddb16f2c')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-c693be2f-fe2a-4562-97f3-7fe9ddb16f2c button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-c693be2f-fe2a-4562-97f3-7fe9ddb16f2c');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-0d7a0da2-18d9-4229-9f91-b15c9d34cedd">
  <button class="colab-df-quickchart" onclick="quickchart('df-0d7a0da2-18d9-4229-9f91-b15c9d34cedd')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-0d7a0da2-18d9-4229-9f91-b15c9d34cedd button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="FPJ3dj53b0vM">
<p>#Why payments data shouldn't be used in predicting Loan should be
disbursed or not?</p>
<ol>
<li><p>If the payments.csv contains information about the payments made
after the loan was granted, including it in your prediction model could
lead to data leakage. This is because you would be using information not
available at the time of loan application to predict its outcome, which
would make your model unrealistic and overly optimistic.</p></li>
<li><p>The payments data might not be temporally relevant to the
prediction you are making. If your model aims to predict the likelihood
of a loan being approved or its risk of default at the time of
application, then payment history, which is future-oriented, would not
be applicable.</p></li>
<li><p>The scope of your model might be to predict initial loan
approval, not the subsequent payment performance of the borrower.
Including payments data would shift the focus of the model to
post-approval events.</p></li>
<li><p>Payment data can be sensitive, as it may include detailed
financial transactions. There could be privacy or regulatory reasons why
this information should not be used in a predictive model.</p></li>
</ol>
<p>In summary, while payments data can be rich in insights for certain
types of models, it might not be appropriate for a loan prediction model
aimed at assessing the risk or approval at the application stage.</p>
</div>
<div class="cell code" data-execution_count="100"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:226}"
id="XhVFypFFkb02" data-outputId="6c0d480d-bc24-4369-98fc-5b6d4e79e675">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>underwriting_var <span class="op">=</span> pd.read_csv(<span class="st">&#39;/content/drive/MyDrive/loan-default-model/clarity_underwriting_variables.csv&#39;</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>underwriting_var.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="100">

  <div id="df-5ecb6fbc-33c3-452c-b5e2-400d2c1ff356" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.thirtydaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.twentyfourhoursago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.oneminuteago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.onehourago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.ninetydaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.sevendaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.tenminutesago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.fifteendaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.threesixtyfivedaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryonfilecurrentaddressconflict</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.totalnumberoffraudindicators</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithaddress</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryageyoungerthanssnissuedate</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresscautious</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddressnonresidential</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresshighrisk</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.ssnreportedmorefrequentlyforanother</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbytradeopenlt90days</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inputssninvalid</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnissuedatecannotbeverified</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresscautious</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.morethan3inquiriesinthelast30days</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddressnonresidential</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedpriortossnissuedate</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseformatinvalid</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnrecordedasdeceased</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresshighrisk</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquirycurrentaddressnotonfile</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnissuedatecannotbeverified</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.highprobabilityssnbelongstoanother</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.maxnumberofssnswithanybankaccount</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnrecordedasdeceased</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbynewtradeonly</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedbeforeage18</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithstate</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseinconsistentwithonfile</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedascellphone</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedashomephone</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamematch</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressmatch</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtype</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncodedescription</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchresult</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncodedescription</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtypedescription</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchresult</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonetype</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobreasoncode</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncode</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncode</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobmatch</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchreasoncode</th>
      <th>clearfraudscore</th>
      <th>underwritingid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>8.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>10.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>match</td>
      <td>partial</td>
      <td>M</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>(A8) Match to Last Name only</td>
      <td>(M) Mobile Phone</td>
      <td>partial</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A8</td>
      <td>match</td>
      <td>6.0</td>
      <td>871.0</td>
      <td>54cbffcee4b0ba763e43144d</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>11.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>21.0</td>
      <td>True</td>
      <td>3.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>match</td>
      <td>mismatch</td>
      <td>M</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>NaN</td>
      <td>(M) Mobile Phone</td>
      <td>partial</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>11.0</td>
      <td>397.0</td>
      <td>54cc0408e4b0418d9a7f78af</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>10.0</td>
      <td>8.0</td>
      <td>2.0</td>
      <td>9.0</td>
      <td>25.0</td>
      <td>False</td>
      <td>3.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>2.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>True</td>
      <td>False</td>
      <td>match</td>
      <td>match</td>
      <td>M</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>NaN</td>
      <td>(M) Mobile Phone</td>
      <td>match</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>1.0</td>
      <td>572.0</td>
      <td>54cc0683e4b0418d9a80adb6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>9.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>9.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>match</td>
      <td>mismatch</td>
      <td>M</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>NaN</td>
      <td>(M) Mobile Phone</td>
      <td>partial</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>11.0</td>
      <td>838.0</td>
      <td>54cc0780e4b0ba763e43b74a</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>6.0</td>
      <td>5.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>6.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>match</td>
      <td>match</td>
      <td>M</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>NaN</td>
      <td>(M) Mobile Phone</td>
      <td>match</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>1.0</td>
      <td>768.0</td>
      <td>54cc1d67e4b0ba763e445b45</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-5ecb6fbc-33c3-452c-b5e2-400d2c1ff356')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-5ecb6fbc-33c3-452c-b5e2-400d2c1ff356 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-5ecb6fbc-33c3-452c-b5e2-400d2c1ff356');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-862a4021-1697-414a-8fe0-bddfafda41d5">
  <button class="colab-df-quickchart" onclick="quickchart('df-862a4021-1697-414a-8fe0-bddfafda41d5')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-862a4021-1697-414a-8fe0-bddfafda41d5 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="101"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:320}"
id="jkHBh56jxEXC" data-outputId="256b69c7-010b-4491-a5b7-28d963db0475">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>underwriting_var.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="101">

  <div id="df-a337ac30-9656-4b62-a888-8c6948452c36" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.thirtydaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.twentyfourhoursago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.oneminuteago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.onehourago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.ninetydaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.sevendaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.tenminutesago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.fifteendaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.threesixtyfivedaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.totalnumberoffraudindicators</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.maxnumberofssnswithanybankaccount</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchreasoncode</th>
      <th>clearfraudscore</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49750.000000</td>
      <td>49735.000000</td>
      <td>49735.000000</td>
      <td>49720.000000</td>
      <td>49615.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7.313628</td>
      <td>4.601990</td>
      <td>2.343980</td>
      <td>4.006874</td>
      <td>10.554513</td>
      <td>5.423799</td>
      <td>3.292121</td>
      <td>6.155578</td>
      <td>20.302291</td>
      <td>2.118327</td>
      <td>7.202554</td>
      <td>11.728842</td>
      <td>683.769787</td>
    </tr>
    <tr>
      <th>std</th>
      <td>6.327122</td>
      <td>3.302288</td>
      <td>1.436345</td>
      <td>2.697831</td>
      <td>10.450845</td>
      <td>4.110483</td>
      <td>2.109667</td>
      <td>4.952620</td>
      <td>23.771239</td>
      <td>1.254602</td>
      <td>79.908530</td>
      <td>14.116701</td>
      <td>126.205372</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>122.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>3.000000</td>
      <td>6.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>592.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>7.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>5.000000</td>
      <td>12.000000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>11.000000</td>
      <td>691.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>9.000000</td>
      <td>5.000000</td>
      <td>3.000000</td>
      <td>5.000000</td>
      <td>13.000000</td>
      <td>6.000000</td>
      <td>4.000000</td>
      <td>7.000000</td>
      <td>25.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>15.000000</td>
      <td>783.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>89.000000</td>
      <td>60.000000</td>
      <td>16.000000</td>
      <td>42.000000</td>
      <td>202.000000</td>
      <td>64.000000</td>
      <td>35.000000</td>
      <td>83.000000</td>
      <td>438.000000</td>
      <td>8.000000</td>
      <td>4056.000000</td>
      <td>125.000000</td>
      <td>965.000000</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-a337ac30-9656-4b62-a888-8c6948452c36')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-a337ac30-9656-4b62-a888-8c6948452c36 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-a337ac30-9656-4b62-a888-8c6948452c36');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-f7b36ee6-8bd8-45bb-9bae-be249f1c4471">
  <button class="colab-df-quickchart" onclick="quickchart('df-f7b36ee6-8bd8-45bb-9bae-be249f1c4471')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-f7b36ee6-8bd8-45bb-9bae-be249f1c4471 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="RuZVNMdbkb03">
<p>Join &amp; merge the two dataframes along the appropriate ID column,
and filter by funded loans.</p>
</div>
<div class="cell code" data-execution_count="102"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:313}"
id="0xcFvz7tkb03" data-outputId="e32a2b95-955a-45ee-e8fa-842f5300585e">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> loan.merge(underwriting_var, left_on<span class="op">=</span><span class="st">&#39;clarityFraudId&#39;</span>, right_on<span class="op">=</span><span class="st">&#39;underwritingid&#39;</span>, how<span class="op">=</span><span class="st">&#39;left&#39;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">&#39;isFunded&#39;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="102">

  <div id="df-0baa3b33-8fcb-49a6-91c1-4b3d504f5711" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>applicationDate</th>
      <th>originated</th>
      <th>originatedDate</th>
      <th>nPaidOff</th>
      <th>approved</th>
      <th>isFunded</th>
      <th>loanStatus</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>state</th>
      <th>leadType</th>
      <th>leadCost</th>
      <th>fpStatus</th>
      <th>clarityFraudId</th>
      <th>hasCF</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.thirtydaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.twentyfourhoursago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.oneminuteago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.onehourago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.ninetydaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.sevendaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.tenminutesago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.fifteendaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudinquiry.threesixtyfivedaysago</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryonfilecurrentaddressconflict</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.totalnumberoffraudindicators</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithaddress</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryageyoungerthanssnissuedate</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresscautious</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddressnonresidential</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddresshighrisk</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.ssnreportedmorefrequentlyforanother</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbytradeopenlt90days</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inputssninvalid</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnissuedatecannotbeverified</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresscautious</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.morethan3inquiriesinthelast30days</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.onfileaddressnonresidential</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedpriortossnissuedate</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseformatinvalid</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inputssnrecordedasdeceased</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquiryaddresshighrisk</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.inquirycurrentaddressnotonfile</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnissuedatecannotbeverified</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.highprobabilityssnbelongstoanother</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.maxnumberofssnswithanybankaccount</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.bestonfilessnrecordedasdeceased</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.currentaddressreportedbynewtradeonly</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.creditestablishedbeforeage18</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.telephonenumberinconsistentwithstate</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.driverlicenseinconsistentwithonfile</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedascellphone</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudindicator.workphonepreviouslylistedashomephone</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamematch</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressmatch</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtype</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncodedescription</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchresult</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncodedescription</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonematchtypedescription</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchresult</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.phonetype</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobreasoncode</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssnnamereasoncode</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.nameaddressreasoncode</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.ssndobmatch</th>
      <th>.underwritingdataclarity.clearfraud.clearfraudidentityverification.overallmatchreasoncode</th>
      <th>clearfraudscore</th>
      <th>underwritingid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>LL-I-06644937</td>
      <td>464f5d9ae4fa09ece4048d949191865c</td>
      <td>B</td>
      <td>199.0</td>
      <td>2016-01-19 22:07:36.778</td>
      <td>True</td>
      <td>2016-01-20 15:49:18.846</td>
      <td>0.0</td>
      <td>True</td>
      <td>1</td>
      <td>Paid Off Loan</td>
      <td>3000.0</td>
      <td>6395.19</td>
      <td>CA</td>
      <td>prescreen</td>
      <td>0</td>
      <td>Checked</td>
      <td>569eb3a3e4b096699f685d64</td>
      <td>1</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>False</td>
      <td>0.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>match</td>
      <td>match</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>invalid</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>partial</td>
      <td>NaN</td>
      <td>D04</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>invalid</td>
      <td>5.0</td>
      <td>879.0</td>
      <td>569eb3a3e4b096699f685d64</td>
    </tr>
    <tr>
      <th>15</th>
      <td>LL-I-12263369</td>
      <td>accf40708233e8b7d05fcb89d5a9c081</td>
      <td>B</td>
      <td>475.0</td>
      <td>2016-11-28 19:54:22.982</td>
      <td>True</td>
      <td>2016-11-29 20:30:40.640</td>
      <td>2.0</td>
      <td>True</td>
      <td>1</td>
      <td>New Loan</td>
      <td>350.0</td>
      <td>893.88</td>
      <td>MO</td>
      <td>organic</td>
      <td>0</td>
      <td>Checked</td>
      <td>NaN</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>33</th>
      <td>LL-I-17826953</td>
      <td>7529d29c9d943cc55bc71a85d9c6b7a3</td>
      <td>W</td>
      <td>645.0</td>
      <td>2017-03-01 15:55:41.823</td>
      <td>True</td>
      <td>2017-03-01 16:15:13.016</td>
      <td>0.0</td>
      <td>True</td>
      <td>1</td>
      <td>New Loan</td>
      <td>400.0</td>
      <td>1364.87</td>
      <td>NJ</td>
      <td>lead</td>
      <td>40</td>
      <td>Checked</td>
      <td>58b6eef8e4b0b6fca82fd426</td>
      <td>1</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>True</td>
      <td>5.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>match</td>
      <td>U</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>NaN</td>
      <td>(U) Unlisted</td>
      <td>match</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>1.0</td>
      <td>658.0</td>
      <td>58b6eef8e4b0b6fca82fd426</td>
    </tr>
    <tr>
      <th>47</th>
      <td>LL-I-16519347</td>
      <td>bc9fa73468acf18cb968a3a6a3c4697c</td>
      <td>S</td>
      <td>490.0</td>
      <td>2017-01-31 17:48:17.381</td>
      <td>True</td>
      <td>2017-01-31 18:00:14.520</td>
      <td>2.0</td>
      <td>True</td>
      <td>1</td>
      <td>Paid Off Loan</td>
      <td>1250.0</td>
      <td>3313.78</td>
      <td>MO</td>
      <td>organic</td>
      <td>0</td>
      <td>Checked</td>
      <td>58450a15e4b0bb9d6d7344c7</td>
      <td>1</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>10.0</td>
      <td>False</td>
      <td>1.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>2.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>partial</td>
      <td>M</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>(A8) Match to Last Name only</td>
      <td>(M) Mobile Phone</td>
      <td>partial</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A8</td>
      <td>match</td>
      <td>6.0</td>
      <td>835.0</td>
      <td>58450a15e4b0bb9d6d7344c7</td>
    </tr>
    <tr>
      <th>54</th>
      <td>LL-I-11506719</td>
      <td>10cefd11d41612b032fd9cd2debe32dc</td>
      <td>B</td>
      <td>590.0</td>
      <td>2016-08-27 09:08:05.442</td>
      <td>True</td>
      <td>2016-08-29 15:05:04.014</td>
      <td>0.0</td>
      <td>True</td>
      <td>1</td>
      <td>Paid Off Loan</td>
      <td>800.0</td>
      <td>2432.08</td>
      <td>CA</td>
      <td>bvMandatory</td>
      <td>10</td>
      <td>Checked</td>
      <td>578f9346e4b0810ad5e7b72e</td>
      <td>1</td>
      <td>13.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>42.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>255.0</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>1.0</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>match</td>
      <td>match</td>
      <td>P</td>
      <td>NaN</td>
      <td>unavailable</td>
      <td>NaN</td>
      <td>(P) Pager</td>
      <td>match</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>match</td>
      <td>1.0</td>
      <td>624.0</td>
      <td>578f9346e4b0810ad5e7b72e</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-0baa3b33-8fcb-49a6-91c1-4b3d504f5711')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-0baa3b33-8fcb-49a6-91c1-4b3d504f5711 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-0baa3b33-8fcb-49a6-91c1-4b3d504f5711');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-da14783b-1bdc-445c-a6e1-4b4976201c4b">
  <button class="colab-df-quickchart" onclick="quickchart('df-da14783b-1bdc-445c-a6e1-4b4976201c4b')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-da14783b-1bdc-445c-a6e1-4b4976201c4b button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="MBB7WXXXkb03">
<p>Then, for brevity, we drop all columns that initially appear to hold
no meaningful information. This includes most features from
clarity_underwriting_variables.csv, since :</p>
<ol>
<li>our model is primarily tasked with risk assessment, not fraud
detection</li>
<li>we'll assume that clearfraudscore sufficiently summarizes the
findings of the underwriting team.</li>
</ol>
</div>
<div class="cell code" data-execution_count="103"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="9kG7bp6Lkb03" data-outputId="50844a00-04e4-4c94-cd63-10675c7ac361">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print clearfraudscore description</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>underwriting_var_columns <span class="op">=</span> pd.read_csv(<span class="st">&#39;/content/drive/MyDrive/loan-default-model/clarity_underwriting_dictionary.csv&#39;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>cfs_desc <span class="op">=</span> underwriting_var_columns[underwriting_var_columns[<span class="st">&#39;fieldName_in_file&#39;</span>] <span class="op">==</span> <span class="st">&#39;clearFraudScore&#39;</span>][<span class="st">&#39;Description&#39;</span>].values[<span class="dv">0</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Clear Fraud Score: </span><span class="sc">{</span>cfs_desc<span class="sc">}</span><span class="ss">.&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Clear Fraud Score: fraud score provided by clarity. Higher score suggests lower default probability.
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="104"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:313}"
id="rxag9lhYkb03" data-outputId="2858ccc3-8e8d-41ac-bee2-78603efed979">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop irrelevant columns</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[<span class="st">&#39;loanId&#39;</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;anon_ssn&#39;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;payFrequency&#39;</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;apr&#39;</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;applicationDate&#39;</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;originatedDate&#39;</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;nPaidOff&#39;</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;loanStatus&#39;</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;loanAmount&#39;</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;state&#39;</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;leadType&#39;</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;leadCost&#39;</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;fpStatus&#39;</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;hasCF&#39;</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;clearfraudscore&#39;</span>]]</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="104">

  <div id="df-48900e07-bb62-4d99-9a54-9ccec53cba73" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>applicationDate</th>
      <th>originatedDate</th>
      <th>nPaidOff</th>
      <th>loanStatus</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>state</th>
      <th>leadType</th>
      <th>leadCost</th>
      <th>fpStatus</th>
      <th>hasCF</th>
      <th>clearfraudscore</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>LL-I-06644937</td>
      <td>464f5d9ae4fa09ece4048d949191865c</td>
      <td>B</td>
      <td>199.0</td>
      <td>2016-01-19 22:07:36.778</td>
      <td>2016-01-20 15:49:18.846</td>
      <td>0.0</td>
      <td>Paid Off Loan</td>
      <td>3000.0</td>
      <td>6395.19</td>
      <td>CA</td>
      <td>prescreen</td>
      <td>0</td>
      <td>Checked</td>
      <td>1</td>
      <td>879.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>LL-I-12263369</td>
      <td>accf40708233e8b7d05fcb89d5a9c081</td>
      <td>B</td>
      <td>475.0</td>
      <td>2016-11-28 19:54:22.982</td>
      <td>2016-11-29 20:30:40.640</td>
      <td>2.0</td>
      <td>New Loan</td>
      <td>350.0</td>
      <td>893.88</td>
      <td>MO</td>
      <td>organic</td>
      <td>0</td>
      <td>Checked</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>33</th>
      <td>LL-I-17826953</td>
      <td>7529d29c9d943cc55bc71a85d9c6b7a3</td>
      <td>W</td>
      <td>645.0</td>
      <td>2017-03-01 15:55:41.823</td>
      <td>2017-03-01 16:15:13.016</td>
      <td>0.0</td>
      <td>New Loan</td>
      <td>400.0</td>
      <td>1364.87</td>
      <td>NJ</td>
      <td>lead</td>
      <td>40</td>
      <td>Checked</td>
      <td>1</td>
      <td>658.0</td>
    </tr>
    <tr>
      <th>47</th>
      <td>LL-I-16519347</td>
      <td>bc9fa73468acf18cb968a3a6a3c4697c</td>
      <td>S</td>
      <td>490.0</td>
      <td>2017-01-31 17:48:17.381</td>
      <td>2017-01-31 18:00:14.520</td>
      <td>2.0</td>
      <td>Paid Off Loan</td>
      <td>1250.0</td>
      <td>3313.78</td>
      <td>MO</td>
      <td>organic</td>
      <td>0</td>
      <td>Checked</td>
      <td>1</td>
      <td>835.0</td>
    </tr>
    <tr>
      <th>54</th>
      <td>LL-I-11506719</td>
      <td>10cefd11d41612b032fd9cd2debe32dc</td>
      <td>B</td>
      <td>590.0</td>
      <td>2016-08-27 09:08:05.442</td>
      <td>2016-08-29 15:05:04.014</td>
      <td>0.0</td>
      <td>Paid Off Loan</td>
      <td>800.0</td>
      <td>2432.08</td>
      <td>CA</td>
      <td>bvMandatory</td>
      <td>10</td>
      <td>Checked</td>
      <td>1</td>
      <td>624.0</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-48900e07-bb62-4d99-9a54-9ccec53cba73')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-48900e07-bb62-4d99-9a54-9ccec53cba73 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-48900e07-bb62-4d99-9a54-9ccec53cba73');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-b2d26f9d-ed30-4eda-9463-c6034f93e68e">
  <button class="colab-df-quickchart" onclick="quickchart('df-b2d26f9d-ed30-4eda-9463-c6034f93e68e')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-b2d26f9d-ed30-4eda-9463-c6034f93e68e button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<section id="data-visualization-and-exploration" class="cell markdown"
id="zeJKCP4EyjMc">
<h1>Data Visualization and Exploration</h1>
</section>
<div class="cell code" data-execution_count="105"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:642}"
id="ROSL0mlT9nqo" data-outputId="8024db50-c639-4eb0-c24a-d2f05ae7ae8f">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Lead Cost by Lead Type</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;muted&quot;</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>average_lead_cost <span class="op">=</span> df.groupby(<span class="st">&#39;leadType&#39;</span>)[<span class="st">&#39;leadCost&#39;</span>].mean()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>average_lead_cost.index, y<span class="op">=</span>average_lead_cost.values, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Average Lead Cost by Lead Type&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Lead Type&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Average Lead Cost&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">&quot;major&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">&#39;grey&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/4f1c70f4e252429d026f418bdaf6279be2fbbd2a.png" /></p>
</div>
</div>
<div class="cell markdown" id="wxxfO4gQ4_6c">
<ol>
<li><p>There is a significant variation in lead costs across different
types. 'California' leads stand out as having a particularly high
average cost compared to other categories.</p></li>
<li><p>Depending on the conversion rate of these leads to actual
customers or the revenue generated, this chart could highlight which
lead types are more cost-effective.</p></li>
<li><p>This could inform where a Money Lion might want to allocate or
reduce spending in their marketing budget.</p></li>
<li><p>If certain lead types with lower costs have a reasonable
conversion rate, it might make sense to focus on these areas.</p></li>
</ol>
<p>In terms of the implications for loan origination and risk
analysis:</p>
<p>Higher Cost and Risk: More expensive leads like 'California' might be
associated with a higher customer lifetime value or might carry a higher
risk, requiring more careful underwriting.</p>
<p>Lower Cost and Conversion: If less expensive lead types like
'lionpay' or 'prescreen' have a decent conversion rate, they might
represent a more efficient acquisition strategy.</p>
<p>Lead Type and Loan Performance: There might be a correlation between
the type of lead and the performance of the loan. For example, 'organic'
leads might show a different risk profile compared to 'prescreen'
leads.</p>
<p><strong>This kind of analysis is critical for understanding the
efficiency of marketing expenditures in loan origination and can also be
a factor in assessing the potential risk associated with different lead
sources.</strong></p>
</div>
<div class="cell code" data-execution_count="106"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:582}"
id="F-wLGnqp9_vI" data-outputId="83b1b7d9-fd12-45b6-cb99-5762fb9988c4">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Paid Off Loans by Payment Frequency</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;Accent&quot;</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>paid_off_loans_by_freq <span class="op">=</span> df[df[<span class="st">&#39;loanStatus&#39;</span>] <span class="op">==</span> <span class="st">&#39;Paid Off Loan&#39;</span>].groupby(<span class="st">&#39;payFrequency&#39;</span>)[<span class="st">&#39;loanId&#39;</span>].count()</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>paid_off_loans_by_freq.index, y<span class="op">=</span>paid_off_loans_by_freq.values, alpha<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Number of Paid Off Loans by Payment Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Payment Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/0bfff64be5b7f0173a50f2e47de75243e8f0b8de.png" /></p>
</div>
</div>
<div class="cell markdown" id="IYYpHsLF7FSF">
<ol>
<li><p>It may indicate common payment behaviors among borrowers. For
example, bi-weekly payments might align better with many customers'
payday schedules, leading to a higher rate of successful loan
payoff.</p></li>
<li><p>The chart could inform risk assessment models. A higher rate of
payoffs in certain payment frequency categories might suggest lower
risk, which could impact the terms of the loan or approval
decisions.</p></li>
<li><p>It might inform the Money Lion about the most popular or
successful repayment plans, potentially guiding product offerings or
marketing strategies.</p></li>
</ol>
<p>For a loan fraud model, these insights could contribute to feature
engineering or segmentation analysis. Payment frequency with its
relation to loan payoff success could be an important feature, possibly
impacting the probability of a loan being fraudulent or at risk of
default. Understanding the patterns in repayment can help identify
normal behavior, against which suspicious or anomalous behavior can be
detected.</p>
</div>
<div class="cell code" data-execution_count="107"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:724}"
id="L59KgAZsEd6Y" data-outputId="a0a6915c-08b0-4aed-e6a1-5350f2d83049">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Loan Amount vs Loan Status</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;tab10&quot;</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span><span class="st">&quot;loanStatus&quot;</span>, y<span class="op">=</span><span class="st">&quot;loanAmount&quot;</span>, data<span class="op">=</span>df, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Loan Amount vs Loan Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Loan Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Loan Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>plt.bar_label(plt.gca().containers[<span class="dv">0</span>], label_type<span class="op">=</span><span class="st">&#39;edge&#39;</span>, padding<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/fec801d0f285a1615a34f7bebedfc1119c737c8e.png" /></p>
</div>
</div>
<div class="cell markdown" id="DgvDr4MxCIrh">
<p>we can see that 'Settlement Paid Off' has the highest average loan
amount, which may indicate larger loans are more likely to end in a
settlement rather than full repayment. Conversely, the status 'Charged
Off Pending Payment' has the lowest average loan amount, potentially
suggesting that smaller loans are more often left unpaid.</p>
</div>
<div class="cell code" data-execution_count="108"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="dMkFl1RO3Foy" data-outputId="4a22ca64-ba7a-4e61-8ff5-ba55101c0dcc">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title loanAmount</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;pastel&quot;</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">&#39;loanAmount&#39;</span>], bins<span class="op">=</span><span class="dv">20</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&quot;skyblue&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Loan Amounts&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Loan Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">&quot;both&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">&#39;grey&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/2ebf25e6623bfbebc1a0520d95a152a28da9cf86.png" /></p>
</div>
</div>
<div class="cell markdown" id="nAgxPVhrVt27">
<ol>
<li><p>The distribution seems to be right-skewed, meaning there are a
large number of loans with smaller amounts and fewer loans as the amount
increases. This is typical for loan distributions, as smaller loans are
more commonly taken out and approved.</p></li>
<li><p>The peak of the histogram occurs in the lower range of loan
amounts, indicating that most borrowers take out smaller loans. For
building a loan fraud model, here are a few considerations:</p></li>
<li><p>The loan amount is a crucial variable as it may impact the
likelihood of fraud. Typically, higher loan amounts could be subjected
to more rigorous underwriting processes.</p></li>
<li><p>Given the skewness of the distribution, it might be beneficial to
transform this variable before using it in the model to achieve a more
normal distribution, which is assumed by many statistical modeling
techniques.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="109"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="3Ynjc8hg-tAM" data-outputId="752b5c1f-225e-4a7b-d0f1-393bd54fb270">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title originallyScheduledPaymentAmount</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;pastel&quot;</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>], bins<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">&quot;blue&quot;</span>, kde<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">&quot;w&quot;</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot for better readability and visual appeal</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Originally Scheduled Payment Amounts&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Originally Scheduled Payment Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">&quot;major&quot;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">&#39;grey&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/95982e1373177a5098dd03092cae4867703797f0.png" /></p>
</div>
</div>
<div class="cell markdown" id="JZ7o6yTszGYc">
<ol>
<li><p>The distribution is right-skewed, indicating that there are a
significant number of loans with lower scheduled payment amounts and
fewer loans with higher scheduled payment amounts.</p></li>
<li><p>The highest peak (mode) of the distribution appears to be around
the $2,500 mark, suggesting that this payment amount is the most common
among the loans.</p></li>
<li><p>The spread of the distribution suggests that there is variability
in the payment amounts, with a long tail extending towards the higher
amounts. This indicates that while most loans have lower payment
amounts, there are some loans with substantially higher payment
amounts.</p></li>
<li><p>The smooth line provided by the KDE suggests the shape of the
distribution if it were to be smoothed out, confirming the right-skewed
nature of the distribution.</p></li>
</ol>
<p>Implications for a loan_fraud model:</p>
<ol>
<li><p>The originally scheduled payment amount could be an important
feature for the loan_fraud model as it gives an indication of the loan
size and the repayment capacity expected of the borrower.</p></li>
<li><p>Loans with very high scheduled payment amounts might be more
scrutinized for fraud risk, as they could represent larger financial
exposures.</p></li>
<li><p>Given the skewness of the distribution, it might be beneficial to
apply a transformation to this feature when using it in a predictive
model to ensure that the model is not unduly influenced by extreme
values.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="110"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="tulJMksN-4WI" data-outputId="3b2ce7b9-124e-4ce4-ae6a-945133076998">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title nPaidOff</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;deep&quot;</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">&#39;nPaidOff&#39;</span>], bins<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">&quot;green&quot;</span>, kde<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">&quot;black&quot;</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/71b27a2ccfa6c78b6f35942f6ce6a5c1011cfb5b.png" /></p>
</div>
</div>
<div class="cell markdown" id="EpexM9sZW9d9">
<ol>
<li><p>The vast majority of clients in this dataset have paid off zero
loans previously, suggesting a lot of new borrowers or one-time
borrowers.</p></li>
<li><p>There is a rapidly diminishing frequency of clients as the number
of previously paid-off loans increases.</p></li>
<li><p>Very few clients have paid off more than five loans.</p></li>
<li><p>The distribution seems to be right-skewed, meaning there are a
large number of loans with smaller amounts and fewer loans as the amount
increases.</p></li>
</ol>
<p>This distribution could imply several things for a loan fraud
model:</p>
<ol>
<li><p>If the number of previously paid-off loans correlates with the
likelihood of paying off future loans, this could be a significant
feature in predicting loan default risk.</p></li>
<li><p>Given the skewness of the distribution, it might be beneficial to
transform this variable before using it in the model to achieve a more
normal distribution, which is assumed by many statistical modeling
techniques.</p></li>
<li><p>The peak of the histogram occurs in the lower range of loan
amounts, indicating that most borrowers take out smaller loans. For
building a loan fraud model, here are a few considerations:</p></li>
<li><p>The loan amount is a crucial variable as it may impact the
likelihood of fraud. Typically, higher loan amounts could be subjected
to more rigorous underwriting processes.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="111"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="SW_BGDnF_dgJ" data-outputId="c20a62ec-aca3-447a-dd46-81f292cc7cb2">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title apr</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;rocket&quot;</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">&#39;apr&#39;</span>], bins<span class="op">=</span><span class="dv">20</span>, color<span class="op">=</span><span class="st">&quot;dodgerblue&quot;</span>, kde<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">&quot;white&quot;</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;APR Distribution&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Annual Percentage Rate (APR)&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/ac8ffe18438827c24349f034a0b8be8c16300724.png" /></p>
</div>
</div>
<div class="cell markdown" id="7Uc5xjr8WM6r">
<ol>
<li><p>The plot shows a concentration of loans with an APR around the
100-200% range, which is significantly high. There are also substantial
frequencies around 500-600%, which might indicate very high-cost loans,
possibly for shorter terms or for customers with higher risk
profiles.</p></li>
<li><p>This is a critical variable, as it represents the cost of
borrowing. High APRs can be indicative of high-risk loans, which could
be more prone to defaults.</p></li>
<li><p>If this data was present, it would indicate how many loans a
customer has previously paid off and could be a good indicator of their
creditworthiness.</p></li>
<li><p>For a loan fraud detection model, APR could be an essential
feature, as unusually high or low APRs might indicate potential fraud or
a high risk of default. If nPaidOff data were available, it would likely
be a valuable predictor, as a history of paying off loans is a positive
credit behavior.</p></li>
<li><p>The note on missing values is crucial; any missing data can skew
analyses and model performance. For example, if APR data is missing for
a significant number of loans, it may impact the model's ability to
accurately assess the risk of loan default.</p></li>
</ol>
<p>Given the plot and the information provided about the columns, the
model would benefit from including features related to payment history,
loan amount, loan cost, and the result of the first payment.</p>
</div>
<div class="cell markdown" id="YDa-LQSzKJNq">
<p>Interestingly all columns containing the financial terms of the loan
are heavily skewed. Since these features are undoubtably important to
the task at hand, we should either pick a model that's robust to
skewness, or normalize these data during preprocessing.</p>
<p>Next, we tackle the features relating to time-components of the loan
application, where if there are any noteworthy trends, we may consider
extracting additional features from the data.</p>
</div>
<div class="cell code" data-execution_count="112"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="10Ux3IeoP5y9" data-outputId="14a1c3c0-a28a-4866-ee57-d4684f6f9951">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># @title originallyScheduledPaymentAmount vs leadCost</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> plt.Normalize(df[<span class="st">&#39;leadCost&#39;</span>].<span class="bu">min</span>(), df[<span class="st">&#39;leadCost&#39;</span>].<span class="bu">max</span>())</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">&quot;viridis&quot;</span>, norm<span class="op">=</span>norm)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>sm.set_array([])</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>], df[<span class="st">&#39;leadCost&#39;</span>], c<span class="op">=</span>df[<span class="st">&#39;leadCost&#39;</span>], cmap<span class="op">=</span><span class="st">&quot;viridis&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolor<span class="op">=</span><span class="st">&#39;w&#39;</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Originally Scheduled Payment Amount vs Lead Cost&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Originally Scheduled Payment Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Lead Cost&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>plt.colorbar(sm, label<span class="op">=</span><span class="st">&#39;Lead Cost&#39;</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/5717569f3a44f81c3449ff3c7b90f7d58f4b6008.png" /></p>
</div>
</div>
<div class="cell markdown" id="PhmNIZ7zBTc4">
<p>The bulk of the data points seem to cluster at the lower end of both
the lead cost and payment amount axes, indicating that most loans have
lower scheduled payment amounts and lower lead costs. However, there are
some outliers with higher values in both, and some leads seem to have a
high cost regardless of the scheduled payment amount.</p>
</div>
<div class="cell code" data-execution_count="113"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="DVOROqInQPRn" data-outputId="845513d1-823d-49a1-b985-b684d14f24e8">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title apr vs nPaidOff</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> plt.Normalize(df[<span class="st">&#39;nPaidOff&#39;</span>].<span class="bu">min</span>(), df[<span class="st">&#39;nPaidOff&#39;</span>].<span class="bu">max</span>())</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, norm<span class="op">=</span>norm)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>sm.set_array([])</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> plt.scatter(df[<span class="st">&#39;apr&#39;</span>], df[<span class="st">&#39;nPaidOff&#39;</span>], c<span class="op">=</span>df[<span class="st">&#39;nPaidOff&#39;</span>], cmap<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;APR vs Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;APR&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>plt.colorbar(sm, label<span class="op">=</span><span class="st">&#39;Number of Paid Off Loans&#39;</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/390483f850738e43d4e8203c4c83e4f4dc109b79.png" /></p>
</div>
</div>
<div class="cell markdown" id="SVEe7gthE-lj">
<ol>
<li><p>The scatter plot shows that most of the data points are
concentrated in the lower ranges of nPaidOff, particularly between 0 and
5. This suggests that the majority of clients have paid off only a few
loans.</p></li>
<li><p>The apr values are spread across the range but seem to cluster in
certain ranges, indicating that specific APR values are more
common.</p></li>
<li><p>There are outliers present, particularly in the apr dimension,
where some loans have exceptionally high APRs. These could be due to
special loan conditions, potential data entry errors, or high-risk
loans.</p></li>
<li><p>There doesn't appear to be a clear linear relationship between
the APR and the number of loans paid off, which suggests that the APR
may not be a direct predictor of the number of loans a client will pay
off.</p></li>
</ol>
<p>In the context of a loan fraud model:</p>
<ol>
<li><p>The number of loans paid off (nPaidOff) could be an indicator of
a client's repayment capability. Clients who have successfully paid off
more loans might be considered lower risk.</p></li>
<li><p>Higher APRs could indicate higher risk loans. The scatter
distribution could be analyzed further to understand if there's a
certain APR threshold that correlates with a change in repayment
behavior.</p></li>
<li><p>The plot might help in segmenting clients based on their loan
repayment history and the APRs of their loans. Different segments might
exhibit different risk profiles, which could be useful for a loan fraud
model.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="114"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="DdWevR9KQenU" data-outputId="d591c040-121b-4391-a805-3bf7eb6331a8">
<div class="sourceCode" id="cb28"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Loan amount vs originally scheduled payment amount</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> plt.Normalize(df[<span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>].<span class="bu">min</span>(), df[<span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>].<span class="bu">max</span>())</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">&quot;plasma&quot;</span>, norm<span class="op">=</span>norm)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>sm.set_array([])</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">&#39;loanAmount&#39;</span>], df[<span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>], c<span class="op">=</span>df[<span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>], cmap<span class="op">=</span><span class="st">&quot;plasma&quot;</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Loan Amount vs Originally Scheduled Payment Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Loan Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Originally Scheduled Payment Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>plt.colorbar(sm, label<span class="op">=</span><span class="st">&#39;Originally Scheduled Payment Amount&#39;</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/3839d991cb7d21d2335ff32e71ddbf21b187688f.png" /></p>
</div>
</div>
<div class="cell markdown" id="htXpxzfIFvQN">
<ol>
<li><p>There appears to be a positive correlation between the loan
amount and the originally scheduled payment amount. This makes sense as
higher loan amounts would generally require larger repayment amounts due
to interest and other fees.</p></li>
<li><p>The distribution is heavier on the lower end, indicating that a
majority of the loans are of smaller amounts.</p></li>
</ol>
<p>In the context of a loan fraud model:</p>
<ol>
<li><p>The ratio of the total scheduled payment amount to the loan
amount can indicate the cost of the loan to the borrower. Unusually high
ratios might be scrutinized for predatory lending practices or incorrect
data.</p></li>
<li><p>If the model detects that loans with certain characteristics
(like extremely high repayment amounts relative to the loan amount) have
a higher likelihood of default, it might weigh these factors more
heavily.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="115"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="JLd5MsmPQdCf" data-outputId="d5fc3d9b-ea8b-460e-ac5c-1da583fd99e7">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title nPaidOff vs loanAmount</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>norm <span class="op">=</span> plt.Normalize(df[<span class="st">&#39;loanAmount&#39;</span>].<span class="bu">min</span>(), df[<span class="st">&#39;loanAmount&#39;</span>].<span class="bu">max</span>())</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span><span class="st">&quot;YlGnBu&quot;</span>, norm<span class="op">=</span>norm)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>sm.set_array([])</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>scatter <span class="op">=</span> plt.scatter(df[<span class="st">&#39;nPaidOff&#39;</span>], df[<span class="st">&#39;loanAmount&#39;</span>], c<span class="op">=</span>df[<span class="st">&#39;loanAmount&#39;</span>], cmap<span class="op">=</span><span class="st">&quot;YlGnBu&quot;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Number of Paid Off Loans vs Loan Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Loan Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>plt.colorbar(sm, label<span class="op">=</span><span class="st">&#39;Loan Amount&#39;</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>plt.gca().spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/5ee289514ef66c466d1cb9936a0f250c03a632f5.png" /></p>
</div>
</div>
<div class="cell markdown" id="SI5RuiOgCRfS">
<ol>
<li><p>The concentration of data points towards the bottom left corner
of the plot suggests that most clients have a small number of paid-off
loans with lower loan amounts.</p></li>
<li><p>There doesn't appear to be a strong trend or correlation between
the number of loans paid off and the loan amount. Most clients with
higher numbers of paid-off loans still fall into the lower to medium
loan amount category.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="116"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="quUS4zIlRC4p" data-outputId="8625c76f-4ac4-47ff-876a-8b931b612a5a">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title payFrequency vs nPaidOff</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="fl">1.2</span> <span class="op">*</span> <span class="bu">len</span>(df[<span class="st">&#39;payFrequency&#39;</span>].unique()))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;nPaidOff&#39;</span>, y<span class="op">=</span><span class="st">&#39;payFrequency&#39;</span>, inner<span class="op">=</span><span class="st">&#39;box&#39;</span>, scale<span class="op">=</span><span class="st">&#39;width&#39;</span>, palette<span class="op">=</span><span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Pay Frequency vs Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>sns.despine(top<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/fabb51fa99bff9cb45559fc2345c0fd5e268f97d.png" /></p>
</div>
</div>
<div class="cell markdown" id="Q-kU7zQ0rzVY">
<ol>
<li><p>The width of each "violin" represents the density of data points
at different counts of paid off loans. Wider sections indicate a higher
frequency of borrowers with that specific number of paid off loans
within the pay frequency category.</p></li>
<li><p>The thicker section of the violin indicates the concentration of
data around a central value, which could suggest the most common number
of loans paid off in each category. Thin sections indicate fewer
customers with that number of paid off loans.</p></li>
</ol>
<p>Implications for loan_fraud model:</p>
<ol>
<li><p>Customers with regular pay frequencies (like weekly or biweekly)
might have different financial behaviors compared to those with
irregular pay frequencies, which could influence their loan repayment
patterns and potentially their risk of fraud.</p></li>
<li><p>The number of previously paid off loans can be an indicator of
creditworthiness and reliability. This feature can be highly relevant in
predicting the likelihood of loan repayment and potential
fraud.</p></li>
</ol>
<p>These insights could be used for feature engineering. For example,
the combination of pay frequency and the number of previously paid off
loans could be a powerful feature in predicting loan repayment.</p>
<p>In the context of a loan_fraud model, this plot suggests that
incorporating both the frequency of loan repayment and the historical
number of paid-off loans could be significant predictors of loan
repayment behavior and thus fraud risk. The variability in the number of
paid-off loans across different pay frequencies may indicate differing
financial management behaviors, which is valuable for risk
assessment.</p>
<p>For instance, borrowers with a higher number of paid-off loans might
be less likely to commit fraud, as they have a demonstrated history of
fulfilling their loan obligations. In contrast, those with fewer or no
paid-off loans might require more in-depth analysis to ascertain their
risk levels.</p>
</div>
<div class="cell code" data-execution_count="117"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:752}"
id="FYIxxferRT6t" data-outputId="92abf550-8655-4846-f17e-7ed5647926f7">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title fpStatus vs nPaidOff</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="fl">1.2</span> <span class="op">*</span> <span class="bu">len</span>(df[<span class="st">&#39;fpStatus&#39;</span>].unique()))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;nPaidOff&#39;</span>, y<span class="op">=</span><span class="st">&#39;fpStatus&#39;</span>, inner<span class="op">=</span><span class="st">&#39;box&#39;</span>, scale<span class="op">=</span><span class="st">&#39;width&#39;</span>, palette<span class="op">=</span><span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;FP Status vs Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>sns.despine(top<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/299671fde43924b879326d1384a18bd14164780b.png" /></p>
</div>
</div>
<div class="cell markdown" id="X5Xn6nXf9ggi">
<ol>
<li><p>The "Checked" category likely represents loans where the first
payment was made successfully. The width of the violin plot for this
category might suggest that both new and returning clients who have
varying numbers of previously paid-off loans fall into this
category.</p></li>
<li><p>The "Rejected" category could indicate loans where the first
payment attempt failed. This might be due to insufficient funds or other
reasons. The distribution could give insights into whether clients who
have a history of paying off loans still experience rejected
payments.</p></li>
<li><p>Other categories like "Skipped", "Cancelled", "Pending", and
"Returned" represent different statuses of the first payment. The
distribution of nPaidOff within these categories could indicate whether
certain payment behaviors are more common among clients with different
levels of previous loan repayment history.</p></li>
</ol>
<p>In the context of creating a loan fraud model, these distributions
could be important. For example, if the "Rejected" category consistently
shows a higher nPaidOff, it might suggest that despite a good history,
certain customers are at risk of defaulting, which could be a signal of
potential fraud or financial distress.</p>
</div>
<div class="cell code" data-execution_count="118"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:752}"
id="oAWN0OC_XiGR" data-outputId="ec4c4cc2-92dd-4224-8539-c11e921be282">
<div class="sourceCode" id="cb32"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title fpStatus vs apr</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="fl">1.2</span> <span class="op">*</span> <span class="bu">len</span>(df[<span class="st">&#39;fpStatus&#39;</span>].unique()))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;apr&#39;</span>, y<span class="op">=</span><span class="st">&#39;fpStatus&#39;</span>, inner<span class="op">=</span><span class="st">&#39;box&#39;</span>, scale<span class="op">=</span><span class="st">&#39;width&#39;</span>, palette<span class="op">=</span><span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;FP Status vs APR&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;APR&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>sns.despine(top<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/9b5d98fda99766e737fb9c16a4cea21fc0f31b7b.png" /></p>
</div>
</div>
<div class="cell markdown" id="WsGfv3dc94DU">
<p>We can make several observations about the apr distribution across
different fpStatus categories:</p>
<ol>
<li><p>Checked: The distribution seems to be multimodal (having multiple
peaks), suggesting there are several common apr values where loans that
have been checked tend to concentrate.</p></li>
<li><p>Rejected: The apr values for rejected first payments are spread
out but also show a multi-modal distribution. There could be common
higher apr rates where rejections are more likely.</p></li>
<li><p>Skipped: The distribution is more compact, indicating less
variation in apr among loans with skipped payments.</p></li>
<li><p>Cancelled: This category has a wide distribution, implying a
diverse apr range, with a slight peak around the lower apr
values.</p></li>
<li><p>Pending: The violin plot for pending status is quite flat and
wide, suggesting that the apr values are uniformly distributed.</p></li>
<li><p>Returned: The shape is more concentrated around the median with
less variability than in some other categories.</p></li>
</ol>
<p>This visualization could help in the analysis of a loan fraud model
by indicating how the apr correlates with the status of the first
payment. For example, it might be found that higher apr rates are
associated with a greater frequency of payment problems such as
rejections and returns. This kind of insight would be valuable in
predicting loan defaults or fraudulent activity.</p>
</div>
<div class="cell code" data-execution_count="119"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="HF-OeTDLX0Z5" data-outputId="dc65a738-e576-492e-f74b-f1968266d0ab">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title payFrequency vs apr</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&quot;Dark2&quot;</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="fl">1.2</span> <span class="op">*</span> <span class="bu">len</span>(df[<span class="st">&#39;payFrequency&#39;</span>].unique()))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">&#39;apr&#39;</span>, y<span class="op">=</span><span class="st">&#39;payFrequency&#39;</span>, inner<span class="op">=</span><span class="st">&#39;box&#39;</span>, scale<span class="op">=</span><span class="st">&#39;width&#39;</span>, palette<span class="op">=</span><span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Pay Frequency vs APR&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;APR&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>sns.despine(top<span class="op">=</span><span class="va">True</span>, right<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>, left<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/095c56784041892acdc94176bb3d89774e32a68e.png" /></p>
</div>
</div>
<div class="cell markdown" id="uZ-NgmcHoxAw">
<p>Bi-weekly (B): The distribution of APRs for bi-weekly payments shows
a concentration around the median, indicating that most APR values are
close to the median.</p>
<p>Weekly (W): This category has a broad distribution of APR values,
suggesting more variability in the rates being offered to customers with
weekly payments.</p>
<p>Semi-monthly (S): The distribution is relatively wide, implying a
significant spread in the APR values for semi-monthly payments.</p>
<p>Monthly (M): The monthly payments show a concentration of APR values
around the median, similar to bi-weekly payments but with a slightly
broader distribution.</p>
<p>Irregular (I): Irregular payments show a broad and flat distribution,
indicating a wide variety of APRs, potentially due to the non-standard
nature of these payment terms.</p>
</div>
<div class="cell code" data-execution_count="120"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:536}"
id="zMeN71YNcfhx" data-outputId="e45fd504-c962-469a-eaa7-097bc303db87">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title applicationDate vs nPaidOff</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _plot_series(series, series_name, series_index<span class="op">=</span><span class="dv">0</span>, palette<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> palette <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> pd.to_datetime(series[<span class="st">&#39;applicationDate&#39;</span>])</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> series[<span class="st">&#39;nPaidOff&#39;</span>]</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs, ys, label<span class="op">=</span>series_name, color<span class="op">=</span>palette[series_index <span class="op">%</span> <span class="bu">len</span>(palette)])</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>df_sorted <span class="op">=</span> df.sort_values(<span class="st">&#39;applicationDate&#39;</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (series_name, series) <span class="kw">in</span> <span class="bu">enumerate</span>(df_sorted.groupby(<span class="st">&#39;fpStatus&#39;</span>)):</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    _plot_series(series, series_name, i, palette<span class="op">=</span>palette)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Application Date vs Number of Paid Off Loans by FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Application Date&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;FP Status&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/eac9bd2078b1703d165da0cd31a38a5a20f0036e.png" /></p>
</div>
</div>
<div class="cell markdown" id="5rkCmYX6-bnZ">
<ol>
<li><p>By stacking the fpStatus categories over the applicationDate, we
can observe how the distribution of first payment statuses changes over
time. It may indicate trends such as an increase in certain payment
statuses at specific times.</p></li>
<li><p>The height of each colored segment in the bars shows the count of
loans with a particular nPaidOff value for each fpStatus category. If
higher bars are visible, this indicates more clients with that
particular number of paid-off loans for the specific first payment
status.</p></li>
<li><p>If we see a lot of 'Checked' statuses with high nPaidOff values,
it may suggest that clients who have paid off multiple loans in the past
continue to perform well. On the other hand, a high number of 'Rejected'
or 'Returned' statuses with high nPaidOff could indicate potential
issues in the lending criteria or changes in the financial status of
previously reliable borrowers.</p></li>
<li><p>There might be patterns indicating seasonality in loan
applications and performance, such as an increase in 'Rejected' payments
during specific months which could align with economic cycles or
spending behavior (like holiday seasons).</p></li>
<li><p>The distribution of fpStatus over time can provide insights into
the effectiveness of the underwriting process and whether certain
periods have higher risk profiles than others.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="121"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:536}"
id="Ohw07qw2c543" data-outputId="d7b86b40-f9fb-46d6-d263-2cb22f95a29d">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title applicationDate vs nPaidOff</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _plot_series(series, series_name, series_index<span class="op">=</span><span class="dv">0</span>, palette<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> palette <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>        palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> pd.to_datetime(series[<span class="st">&#39;applicationDate&#39;</span>])</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> series[<span class="st">&#39;nPaidOff&#39;</span>]</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs, ys, label<span class="op">=</span>series_name, color<span class="op">=</span>palette[series_index <span class="op">%</span> <span class="bu">len</span>(palette)])</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>df_sorted <span class="op">=</span> df.sort_values(<span class="st">&#39;applicationDate&#39;</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (series_name, series) <span class="kw">in</span> <span class="bu">enumerate</span>(df_sorted.groupby(<span class="st">&#39;payFrequency&#39;</span>)):</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    _plot_series(series, series_name, i, palette<span class="op">=</span>palette)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Application Date vs Number of Paid Off Loans by Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Application Date&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Paid Off Loans&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;Pay Frequency&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/c2205a78983255fb7b5bbe064bb6bb598be3e054.png" /></p>
</div>
</div>
<div class="cell markdown" id="zRPjBcRqn5pa">
<p>From this plot, you can infer several things:</p>
<ol>
<li><p>How the number of paid-off loans has changed over the given
period. For instance, you might observe seasonal trends or
growth/shrinkage in the number of paid-off loans.</p></li>
<li><p>Which repayment frequencies are associated with higher numbers of
paid-off loans. This could inform strategies to promote certain payment
schedules.</p></li>
<li><p>This visualization could indirectly suggest which pay frequencies
have better loan performance. For example, if a certain frequency
consistently has more paid-off loans, it might be considered more
reliable.</p></li>
</ol>
<p>In terms of creating a loan fraud model:</p>
<ol>
<li><p>Understanding the distribution of nPaidOff across different
repayment frequencies might help in identifying patterns that are common
among customers who do not default on their loans.</p></li>
<li><p>If certain frequencies show a propensity for customers to pay off
their loans, it could be a signal of lower risk, which would be valuable
information for the model.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="122"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:536}"
id="M_T6ghiLdQjb" data-outputId="28cc9255-a91c-48e6-9bc3-f64d01ebccea">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title applicationDate vs apr</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _plot_series(series, series_name, series_index<span class="op">=</span><span class="dv">0</span>, palette<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> palette <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> pd.to_datetime(series[<span class="st">&#39;applicationDate&#39;</span>])</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> series[<span class="st">&#39;apr&#39;</span>]</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs, ys, label<span class="op">=</span>series_name, color<span class="op">=</span>palette[series_index <span class="op">%</span> <span class="bu">len</span>(palette)])</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>df_sorted <span class="op">=</span> df.sort_values(<span class="st">&#39;applicationDate&#39;</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (series_name, series) <span class="kw">in</span> <span class="bu">enumerate</span>(df_sorted.groupby(<span class="st">&#39;fpStatus&#39;</span>)):</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    _plot_series(series, series_name, i, palette<span class="op">=</span>palette)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Application Date vs APR by FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)  <span class="co"># Adding a meaningful title</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Application Date&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;APR&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;FP Status&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/b2c0d444bd145060325c792b1a52b88dce97d1ca.png" /></p>
</div>
</div>
<div class="cell markdown" id="vQkcTnO2cf_m">
<p>The APR (apr) varies over time, which is depicted by the vertical
lines spanning from the bottom to the top of the plot. This variability
could be due to changes in market interest rates, risk assessments, or
lending policies.</p>
<p>Categorization: The different colors represent the different
categories of the first payment status (fpStatus). The legend suggests
that we have categories for payments that are checked, canceled,
pending, rejected, returned, and skipped.</p>
<p>Density and Outliers: Where lines are dense and overlapping, it
suggests many loans are concentrated around certain APR values for each
fpStatus category during those times. Outliers, where lines extend to
the top or bottom of the plot outside the denser areas, indicate less
common APR values for loans in each status category.</p>
<p>Time Trends: By observing the concentration of lines vertically, one
could infer periods of higher or lower APR values. If certain periods
show denser clusters of higher APR values, it could indicate a shift in
lending policy or external economic conditions affecting the rates
offered.</p>
<p>Status Significance: If certain fpStatus categories like 'Rejected'
or 'Pending' consistently appear at higher APR levels, it could suggest
that higher rates are correlated with these statuses. For instance,
higher APRs might be indicative of higher risk, leading to more
rejections or pending statuses.</p>
<p>In the context of creating a loan fraud model:</p>
<p>The time trend of APR might inform the model that the economic or
business factors affecting APRs change over time, which in turn might
influence the likelihood of a loan being paid off or defaulting. If
certain fpStatus categories are correlated with higher or lower APRs,
this might be a significant feature in predicting loan default risk.</p>
</div>
<div class="cell code" data-execution_count="123"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:536}"
id="0XYwzGdvg0CX" data-outputId="e5f43546-2f44-4420-d3be-164236cdd66a">
<div class="sourceCode" id="cb37"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title applicationDate vs apr</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _plot_series(series, series_name, series_index<span class="op">=</span><span class="dv">0</span>, palette<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> palette <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    xs <span class="op">=</span> pd.to_datetime(series[<span class="st">&#39;applicationDate&#39;</span>])</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    ys <span class="op">=</span> series[<span class="st">&#39;apr&#39;</span>]</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    plt.plot(xs, ys, label<span class="op">=</span>series_name, color<span class="op">=</span>palette[series_index <span class="op">%</span> <span class="bu">len</span>(palette)])</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>df_sorted <span class="op">=</span> df.sort_values(<span class="st">&#39;applicationDate&#39;</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(<span class="st">&#39;Dark2&#39;</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (series_name, series) <span class="kw">in</span> <span class="bu">enumerate</span>(df_sorted.groupby(<span class="st">&#39;payFrequency&#39;</span>)):</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    _plot_series(series, series_name, i, palette<span class="op">=</span>palette)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Application Date vs APR by Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Application Date&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;APR&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;Pay Frequency&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/d460159c118ec1cfbbff16445574ae924b318a30.png" /></p>
</div>
</div>
<div class="cell markdown" id="Yf_MFJoBbj29">
<ol>
<li><p>The plot displays the changes in APR over time for different
payment frequencies. It allows us to observe trends, seasonality, or any
anomalies in the APR rates across different times.</p></li>
<li><p>Each vertical line represents the range of APRs for loans
initiated on a particular date, with the color coding corresponding to
the payment frequency. The thickness of these lines at any given time
point might suggest the volume of loans with that specific APR and
payment frequency.</p></li>
<li><p>The vertical spread of the lines shows the variability in the APR
for loans on different application dates. A longer line indicates a
wider range of APRs offered on that date.</p></li>
<li><p>By comparing different colors, we can infer which payment
frequency typically has higher or lower APRs, which could be critical
for risk assessment and loan pricing.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="124"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:601}"
id="LgB_p2g7kdBC" data-outputId="4d4ce283-1587-41c7-efef-43a5fbdb1f4c">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Approval Rate by Lead Type</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>approval_rate_by_lead <span class="op">=</span> df.groupby(<span class="st">&#39;leadType&#39;</span>)[<span class="st">&#39;loanStatus&#39;</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).unstack() <span class="op">*</span> <span class="dv">100</span>  <span class="co"># Convert to percentage</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>approval_rate_by_lead.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax, colormap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Approval Rate by Lead Type&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Lead Type&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Percentage (%)&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">&#39;Loan Status&#39;</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">&#39;upper left&#39;</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/abd22a28888998992b0ba683f5e5c03c3b6ce19f.png" /></p>
</div>
</div>
<div class="cell markdown" id="zn3XuP3sUe-M">
<ol>
<li><p>Certain lead types, like "prescreen" and "organic", have a higher
proportion of "Paid Off Loan" status, suggesting that leads from these
sources perform well in terms of repayments.</p></li>
<li><p>Other lead types, like "lionpay" and "repeat", have more diverse
statuses with significant portions in "Pending Paid Off" and "New Loan"
statuses.</p></li>
<li><p>The "bvMandatory" lead type has a notable proportion of "Charged
Off" and "External Collection", which might suggest leads from this
category carry higher risk.</p></li>
</ol>
<p>In terms of creating a loan fraud model:</p>
<ol>
<li><p>The proportions of loan statuses like "Charged Off" or
"Collection" could help in assessing the risk associated with each lead
type. Lead types with higher percentages of negative statuses could be
flagged for more careful scrutiny.</p></li>
<li><p>The lead type could be used as a categorical feature in the
model, as it seems to have a relationship with the likelihood of a loan
being paid off or going into a negative status.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="125"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:582}"
id="qR0ZsYxv8t2i" data-outputId="2e2e2778-6bbf-416b-e0ec-4c78401384af">
<div class="sourceCode" id="cb39"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Loan Amount Distribution by Pay Frequency</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the style of seaborn</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boxplot</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))  <span class="co"># Set the figure size</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">&#39;payFrequency&#39;</span>, y<span class="op">=</span><span class="st">&#39;loanAmount&#39;</span>, data<span class="op">=</span>df, palette<span class="op">=</span><span class="st">&quot;coolwarm&quot;</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot with titles, labels, and other aesthetics</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Loan Amount Distribution by Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Loan Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)  <span class="co"># Rotate x-axis labels to make them readable</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">&quot;both&quot;</span>, ls<span class="op">=</span><span class="st">&quot;--&quot;</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Customize grid lines</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/df2978af3cf22ddf8e9ce76ba6184eca734ec2bc.png" /></p>
</div>
</div>
<div class="cell markdown" id="pa4eY5HjGkEk">
<ol>
<li><p>Bi-weekly (B) and weekly (W) payment frequencies have a larger
number of outliers with higher loan amounts, which could indicate that
these frequencies are chosen for both small and larger loans.</p></li>
<li><p>Monthly (M) payments show a fairly uniform distribution with
fewer outliers, suggesting that the loan amounts for monthly payments
are more consistent.</p></li>
<li><p>Semi-monthly (S) and irregular (I) payments also display outliers
but to a lesser extent, which might indicate variability in loan amounts
but less so than the bi-weekly and weekly categories.</p></li>
<li><p>The median loan amount is fairly consistent across different
payment frequencies, although the median for weekly payments appears to
be slightly lower.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="126"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:601}"
id="8dabRVanlT0I" data-outputId="12c6facd-fd16-4aff-cb1f-733eb4ec4dca">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Average Loan Amount over Time</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>df_grouped <span class="op">=</span> df.groupby(<span class="st">&#39;applicationDate&#39;</span>)[<span class="st">&#39;loanAmount&#39;</span>].mean()</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>plt.plot(df_grouped.index, df_grouped.values, color<span class="op">=</span><span class="st">&#39;deepskyblue&#39;</span>, label<span class="op">=</span><span class="st">&#39;Average Loan Amount&#39;</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>plt.fill_between(df_grouped.index, df_grouped.values, color<span class="op">=</span><span class="st">&#39;lightblue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Average Loan Amount over Time&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Application Date&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Average Loan Amount ($)&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/1f050e5d515e2c7aef4927321bcbcec2096a5f8b.png" /></p>
</div>
</div>
<div class="cell markdown" id="Nelaa3Ckanh3">
<ol>
<li><p>Each bar seems to correspond to a time interval (possibly a
month) and shows the volume of loan applications for that
period.</p></li>
<li><p>There is a noticeable trend in the data with periodic peaks,
which could indicate seasonality in loan application volumes. The
highest peaks might correspond to times of the year when more people
apply for loans.</p></li>
<li><p>It's important to note when the peaks occur, as this might reveal
important business insights—such as increased loan applications during
holiday seasons or at the start of school terms.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="127"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:605}"
id="cAP4aO0sq4x2" data-outputId="cef0111b-b6ca-4b36-9a15-1b33dd175b86">
<div class="sourceCode" id="cb41"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title payFrequency</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>pay_frequency_counts <span class="op">=</span> df.groupby(<span class="st">&#39;payFrequency&#39;</span>).size()</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>sns.barplot(y<span class="op">=</span>pay_frequency_counts.index, x<span class="op">=</span>pay_frequency_counts.values, palette<span class="op">=</span><span class="st">&#39;Dark2&#39;</span>, orient<span class="op">=</span><span class="st">&#39;h&#39;</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Count&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/dd7f7fca46bf4b4fa6a493f4bdebceb9ec74593f.png" /></p>
</div>
</div>
<div class="cell markdown" id="BmdepXouYVrx">
<p>The category marked 'B' has the longest bar, suggesting that it has
the highest count or total amount related to the loans among all the
payment frequency categories.</p>
<p>'W' also has a long bar, indicating it's the second most frequent or
largest by the total amount metric being measured. 'I' has the shortest
bar, which suggests it has the lowest count or total amount.</p>
<p>'M' and 'S' have moderate-length bars, which indicates that they have
more occurrences or a larger total amount than 'I' but less than 'B' and
'W'.</p>
</div>
<div class="cell code" data-execution_count="128"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="BaurJqf3rbxA" data-outputId="42bc8418-d753-4657-d473-e5dc1e64f0e8">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title fpStatus</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>fp_status_counts <span class="op">=</span> df.groupby(<span class="st">&#39;fpStatus&#39;</span>).size()</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>sns.barplot(y<span class="op">=</span>fp_status_counts.index, x<span class="op">=</span>fp_status_counts.values, palette<span class="op">=</span><span class="st">&#39;Dark2&#39;</span>, orient<span class="op">=</span><span class="st">&#39;h&#39;</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Count&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/5c242bf1c1f6731d591c3576a843ed279f972777.png" /></p>
</div>
</div>
<div class="cell markdown" id="qXUpWFCBYd1J">
<ol>
<li><p>"Checked" Status: The longest bar indicates that the "Checked"
status has the highest count among the categories. This likely means
that most of the first payments have been successfully
processed.</p></li>
<li><p>"Cancelled" and "Skipped" Statuses: These have the shortest bars,
suggesting that there are relatively few instances where the first
payment has been cancelled or skipped.</p></li>
<li><p>"Pending" and "Rejected" Statuses: These statuses have moderate
counts, indicating a middle-ground frequency compared to the "Checked"
and "Cancelled" statuses.</p></li>
<li><p>Variation in First Payment Status: There is a considerable
variation in the frequency of different first payment outcomes, with
"Checked" being the most common, which is a positive sign in terms of
loan repayment.</p></li>
</ol>
<p>For a loan fraud model:</p>
<ol>
<li><p>A high number of "Checked" statuses could indicate a healthy loan
portfolio with a good repayment start. However, a fraud model would need
to verify these are genuine and not due to any manipulative
practices.</p></li>
<li><p>High numbers of "Rejected" or "Cancelled" first payments could be
flags for potential fraud or credit risk.</p></li>
<li><p>"Skipped" payments could be particularly suspicious and might
trigger additional investigation in a fraud detection system.</p></li>
<li><p>The distribution of first payment statuses could be incorporated
into risk models as predictors for future loan performance.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="129"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:501}"
id="SWscE7UDHL0w" data-outputId="27e60675-e606-4b30-884c-c23f6e163b01">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Loan Status Distribution by Pay Frequency</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>loan_status_distribution <span class="op">=</span> df.groupby([<span class="st">&#39;payFrequency&#39;</span>, <span class="st">&#39;loanStatus&#39;</span>])[<span class="st">&#39;loanId&#39;</span>].count().unstack()</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>loan_status_distribution.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, stacked<span class="op">=</span><span class="va">True</span>, colormap<span class="op">=</span><span class="st">&#39;Paired&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Loan Status Distribution by Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/f37259ca191c85b2331956871d69745219f26bfb.png" /></p>
</div>
</div>
<div class="cell markdown" id="S74aOkJCZXz6">
<p>Bi-weekly (B): This category has a high number of loans across
various statuses, with a significant portion in "Paid Off Loan," which
could suggest a higher completion rate for loans on this payment
schedule.</p>
<p>Irregular (–): There's a low count of loans with irregular payment
frequencies, indicating they are less common or perhaps more prone to
issues given the presence of statuses like "Charged Off" and "External
Collection."</p>
<p>Semi-monthly (Σ): This payment frequency shows a moderate number of
loans and appears to have a high proportion of "Pending Paid Off"
loans.</p>
<p>Weekly (W): Weekly payments have a tall bar primarily composed of
"Paid Off Loan," suggesting a good track record of loan repayments on
this schedule.</p>
</div>
<div class="cell code" data-execution_count="130"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:536}"
id="xTXzKysosQZ1" data-outputId="19fff384-c564-42df-ec10-7dd7179e1451">
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Loan Amount Distribution by State</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>df_state_avg <span class="op">=</span> df.groupby(<span class="st">&#39;state&#39;</span>)[<span class="st">&#39;loanAmount&#39;</span>].mean()</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>df_state_avg.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, color<span class="op">=</span><span class="st">&#39;skyblue&#39;</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Loan Amount Distribution by State&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;State&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Average Loan Amount&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>plt.gca().yaxis.set_major_formatter(plt.FuncFormatter(<span class="kw">lambda</span> x, _: <span class="st">&#39;${:,.0f}&#39;</span>.<span class="bu">format</span>(x)))</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>sns.despine(left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/4d4716cac8eb2a86907536f39afb80fac7c8cd0b.png" /></p>
</div>
</div>
<div class="cell markdown" id="ARTTsC3Ba_b3">
<ol>
<li><p>The chart shows substantial variation in average loan amounts by
state. This could be due to differences in economic conditions, lending
regulations, or consumer behavior in different states.</p></li>
<li><p>Some states, like CA, show significantly higher average loan
amounts than others. This might reflect the higher cost of living in
these states or might indicate that the lending institution is more
comfortable offering larger loans in these areas due to factors like
average income or repayment history.</p></li>
<li><p>Model Training: When training a fraud detection model, it's
important to account for such geographical variations. The model might
learn that certain loan amounts are more typical in certain states and
thus might not flag them as potential fraud in those regions, while the
same amounts could be deemed suspicious in other states.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="131"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:801}"
id="WQ3VptT5spaU" data-outputId="dd7302f9-5d40-440b-e643-7a063709970b">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title payFrequency vs fpStatus</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">&quot;white&quot;</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>pivot_df <span class="op">=</span> df.pivot_table(index<span class="op">=</span><span class="st">&#39;fpStatus&#39;</span>, columns<span class="op">=</span><span class="st">&#39;payFrequency&#39;</span>, aggfunc<span class="op">=</span><span class="st">&#39;size&#39;</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>sns.heatmap(pivot_df, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&quot;d&quot;</span>, linewidths<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Pay Frequency vs FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Pay Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;FP Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>sns.despine(offset<span class="op">=</span><span class="dv">10</span>, trim<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/11d26488d0684e69c13cddbc879507c7abbaee11.png" /></p>
</div>
</div>
<div class="cell markdown" id="tx0eA67NHZSm">
<ol>
<li><p>Bi-weekly (B) and weekly (W) payments seem to have a higher count
of loans with a 'Checked' status, which may indicate that the first
payments on these loans are often successful.</p></li>
<li><p>Monthly (M) payments show a significant number of loans with a
'Pending' status, suggesting many first payments are awaiting
completion.</p></li>
<li><p>Irregular (I) and semi-monthly (S) payments have lower counts
across all fpStatus categories, which might imply these are less common
payment frequencies or have fewer issues with first payments.</p></li>
</ol>
<p>In terms of loan fraud analysis:</p>
<ol>
<li><p>Parts of the heatmap with darker colors (higher counts) can
indicate common patterns or expected behaviors, which can be useful as
benchmarks for detecting anomalies.</p></li>
<li><p>Lighter areas might be less common but could still be
significant, especially if they represent potentially risky statuses
like 'Rejected' or 'Cancelled'.</p></li>
<li><p>Consistent patterns across payment frequencies might reveal
systematic issues or behaviors in loan payments that could be relevant
for fraud detection.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="132"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:601}"
id="2WG33gSVg_QN" data-outputId="36430f33-7c7a-433e-e8fe-7ceea1d75949">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Distribution of Clearfraud Score</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&quot;white&quot;</span>)  <span class="co"># Provides a clean background</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">&#39;clearfraudscore&#39;</span>], bins<span class="op">=</span><span class="dv">20</span>, kde<span class="op">=</span><span class="va">True</span>, color<span class="op">=</span><span class="st">&#39;steelblue&#39;</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Clearfraud Score&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Frequency&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Distribution of Clearfraud Score&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/22ea044abf4236a11a1448bb5a7373a2fa9d32b1.png" /></p>
</div>
</div>
<div class="cell markdown" id="dOG0doahHufG">
<ol>
<li><p>The distribution looks roughly bell-shaped, indicating a normal
distribution of Clearfraud scores. This suggests most scores are around
the center of the range, with fewer scores at the extreme low and high
ends.</p></li>
<li><p>The Clearfraud scores appear to range from below 200 to 1000,
with the majority of scores concentrated in the middle of the
range.</p></li>
<li><p>The tallest bars are around the 500 to 700 score range, which
could be the average risk score for this set of loans or
applicants.</p></li>
<li><p>If a higher Clearfraud score indicates a higher risk of fraud,
then this histogram shows that most applicants or transactions are
assessed to be of moderate risk.</p></li>
<li><p>There are fewer applicants or loans with very high or very low
Clearfraud scores. If a low score indicates a lower risk, it suggests
there are few 'very safe' loans, and similarly, few 'very high risk'
loans.</p></li>
</ol>
</div>
<section id="imputing-missing-values" class="cell markdown"
id="IAF1Ve9nkb03">
<h2>Imputing Missing Values</h2>
<p>We proceed accordingly by checking whether there are any missing
values present in our data.</p>
</section>
<div class="cell code" data-execution_count="133" id="4PuSlDJmIxRZ">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title check_nan()</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_nan(df):</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This enhanced function calculates the percentage of missing values in each column of a pandas dataframe</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">    and returns a styled DataFrame with these percentages for columns with missing values only. Columns are color-coded</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">    to highlight the severity of missing data.</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">        df: A pandas DataFrame.</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">        A styled pandas DataFrame object that color-codes the missing percentages to make high missing values stand out.</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate percentage of missing values</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    missing_values_percentage <span class="op">=</span> df.isnull().mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to include only columns with missing values and sort them by descending order of missing percentage</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    missing_values_filtered <span class="op">=</span> missing_values_percentage[missing_values_percentage <span class="op">&gt;</span> <span class="dv">0</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format as percentages with 2 decimals and convert to DataFrame</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    missing_values_df <span class="op">=</span> pd.DataFrame(missing_values_filtered.<span class="bu">round</span>(<span class="dv">2</span>), columns<span class="op">=</span>[<span class="st">&#39;Missing Percentage&#39;</span>])</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define a styling function to color-code the missing percentages</span></span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> color_missing_values(val):</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a><span class="co">        Colors values based on their magnitude to highlight high percentages of missing values.</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> <span class="st">&#39;red&#39;</span> <span class="cf">if</span> val <span class="op">&gt;</span> <span class="dv">50</span> <span class="cf">else</span> <span class="st">&#39;orange&#39;</span> <span class="cf">if</span> val <span class="op">&gt;</span> <span class="dv">20</span> <span class="cf">else</span> <span class="st">&#39;green&#39;</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f&#39;color: </span><span class="sc">{</span>color<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply the styling function to the DataFrame</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>    styled_df <span class="op">=</span> missing_values_df.style.applymap(color_missing_values, subset<span class="op">=</span>[<span class="st">&#39;Missing Percentage&#39;</span>])<span class="op">\</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>                                        .<span class="bu">format</span>({<span class="st">&#39;Missing Percentage&#39;</span>: <span class="st">&#39;</span><span class="sc">{}</span><span class="st">%&#39;</span>})</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> styled_df</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="134"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:143}"
id="jz4DQ9t4kb03" data-outputId="3f1ecb66-d858-4819-c4dd-c81508b4af12">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute % of missing values in each column</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>check_nan(df)</span></code></pre></div>
<div class="output execute_result" data-execution_count="134">
<style type="text/css">
#T_e2fd5_row0_col0, #T_e2fd5_row1_col0, #T_e2fd5_row2_col0 {
  color: green;
}
</style>
<table id="T_e2fd5" class="dataframe">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e2fd5_level0_col0" class="col_heading level0 col0" >Missing Percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e2fd5_level0_row0" class="row_heading level0 row0" >clearfraudscore</th>
      <td id="T_e2fd5_row0_col0" class="data row0 col0" >17.69%</td>
    </tr>
    <tr>
      <th id="T_e2fd5_level0_row1" class="row_heading level0 row1" >nPaidOff</th>
      <td id="T_e2fd5_row1_col0" class="data row1 col0" >0.05%</td>
    </tr>
    <tr>
      <th id="T_e2fd5_level0_row2" class="row_heading level0 row2" >fpStatus</th>
      <td id="T_e2fd5_row2_col0" class="data row2 col0" >0.02%</td>
    </tr>
  </tbody>
</table>

</div>
</div>
<div class="cell markdown" id="EQuJBZbYkb03">
<p>Notice that <code>clearfraudscore</code> and <code>nPaidOff</code>
both have <code>NaN</code> values that we must handle (we'll most likely
end up dropping <code>fpStatus</code> so we'll deal with that column
later). Beginning with the former, let's first observe how the data are
distributed.</p>
</div>
<div class="cell code" data-execution_count="135" id="u4XIoLWwkb03">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">&#39;clearfraudscore&#39;</span>].isna(), <span class="st">&#39;clearfraudscore&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;clearfraudscore&#39;</span>].median()</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">&#39;nPaidOff&#39;</span>].isna(), <span class="st">&#39;nPaidOff&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;nPaidOff&#39;</span>].mode()[<span class="dv">0</span>]</span></code></pre></div>
</div>
<section id="impute-categorical-variables" class="cell markdown"
id="BwC5ZbIdkb04">
<h2>Impute Categorical Variables</h2>
<p>Next, we'll look over the dtype of each column, keeping an eye out
for any categorical variables</p>
</section>
<div class="cell code" data-execution_count="136"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="5hy6Bq-Kkb04" data-outputId="4c13e46a-832f-4b1d-ac63-261080e11031">
<div class="sourceCode" id="cb50"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print concise summary of df</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>df.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 38982 entries, 1 to 577662
Data columns (total 16 columns):
 #   Column                            Non-Null Count  Dtype         
---  ------                            --------------  -----         
 0   loanId                            38982 non-null  object        
 1   anon_ssn                          38982 non-null  object        
 2   payFrequency                      38982 non-null  object        
 3   apr                               38982 non-null  float64       
 4   applicationDate                   38982 non-null  datetime64[ns]
 5   originatedDate                    38982 non-null  datetime64[ns]
 6   nPaidOff                          38982 non-null  float64       
 7   loanStatus                        38982 non-null  object        
 8   loanAmount                        38982 non-null  float64       
 9   originallyScheduledPaymentAmount  38982 non-null  float64       
 10  state                             38982 non-null  object        
 11  leadType                          38982 non-null  object        
 12  leadCost                          38982 non-null  int64         
 13  fpStatus                          38973 non-null  object        
 14  hasCF                             38982 non-null  int64         
 15  clearfraudscore                   38982 non-null  float64       
dtypes: datetime64[ns](2), float64(5), int64(2), object(7)
memory usage: 6.1+ MB
</code></pre>
</div>
</div>
<div class="cell markdown" id="m9W1rVU4kb04">
<p>We notice several columns with <code>dtype == 'object'</code>, which
we'll address in order:</p>
<ul>
<li><code>loanId</code> &amp; <code>anon_ssn</code> are unique
identifiers -&gt; no further action required</li>
<li><code>payFrequency</code> may be of use to us -&gt; <strong>further
action required</strong></li>
<li><code>loanStatus</code> will be addressed during feature engineering
-&gt; skip for now</li>
<li><code>state</code> contains demographic data, which we'll refrain
from using due to the potential for bias/discrimination (see "Further
Work" section) -&gt; drop column</li>
<li><code>leadType</code> may be of use to us -&gt; <strong>further
action required</strong></li>
<li><code>fpStatus</code> contains data that won't be available during
model prediction (i.e. target leakage) -&gt; drop column</li>
</ul>
<p>It follows, since <code>payFrequency</code> is an ordinal variable,
whereas <code>leadType</code> is a nominal variable, we'll apply ordinal
&amp; one-hot encoding, respectively.</p>
</div>
<div class="cell code" data-execution_count="137"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:634}"
id="WccVlnf_kb04" data-outputId="d34d32bd-42cd-456d-8d64-f1ac8ba1c1d9">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop irrelevant columns</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">&#39;state&#39;</span>, <span class="st">&#39;fpStatus&#39;</span>])</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordinal encoding</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;payFrequency&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;payFrequency&#39;</span>].<span class="bu">map</span>({<span class="st">&#39;W&#39;</span>: <span class="dv">0</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;B&#39;</span>: <span class="dv">1</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;S&#39;</span>: <span class="dv">2</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;M&#39;</span>: <span class="dv">3</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&#39;I&#39;</span>: <span class="dv">4</span>})</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encoding</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(df, columns<span class="op">=</span>[<span class="st">&#39;leadType&#39;</span>])</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<div class="output execute_result" data-execution_count="137">

  <div id="df-109802fa-0325-4455-b92a-6a8f23c945c1" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>applicationDate</th>
      <th>originatedDate</th>
      <th>nPaidOff</th>
      <th>loanStatus</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>leadCost</th>
      <th>hasCF</th>
      <th>clearfraudscore</th>
      <th>leadType_bvMandatory</th>
      <th>leadType_california</th>
      <th>leadType_express</th>
      <th>leadType_instant-offer</th>
      <th>leadType_lead</th>
      <th>leadType_lionpay</th>
      <th>leadType_organic</th>
      <th>leadType_prescreen</th>
      <th>leadType_rc_returning</th>
      <th>leadType_repeat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>LL-I-06644937</td>
      <td>464f5d9ae4fa09ece4048d949191865c</td>
      <td>1</td>
      <td>199.0</td>
      <td>2016-01-19 22:07:36.778</td>
      <td>2016-01-20 15:49:18.846</td>
      <td>0.0</td>
      <td>Paid Off Loan</td>
      <td>3000.0</td>
      <td>6395.19</td>
      <td>0</td>
      <td>1</td>
      <td>879.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>LL-I-12263369</td>
      <td>accf40708233e8b7d05fcb89d5a9c081</td>
      <td>1</td>
      <td>475.0</td>
      <td>2016-11-28 19:54:22.982</td>
      <td>2016-11-29 20:30:40.640</td>
      <td>2.0</td>
      <td>New Loan</td>
      <td>350.0</td>
      <td>893.88</td>
      <td>0</td>
      <td>0</td>
      <td>693.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>33</th>
      <td>LL-I-17826953</td>
      <td>7529d29c9d943cc55bc71a85d9c6b7a3</td>
      <td>0</td>
      <td>645.0</td>
      <td>2017-03-01 15:55:41.823</td>
      <td>2017-03-01 16:15:13.016</td>
      <td>0.0</td>
      <td>New Loan</td>
      <td>400.0</td>
      <td>1364.87</td>
      <td>40</td>
      <td>1</td>
      <td>658.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>47</th>
      <td>LL-I-16519347</td>
      <td>bc9fa73468acf18cb968a3a6a3c4697c</td>
      <td>2</td>
      <td>490.0</td>
      <td>2017-01-31 17:48:17.381</td>
      <td>2017-01-31 18:00:14.520</td>
      <td>2.0</td>
      <td>Paid Off Loan</td>
      <td>1250.0</td>
      <td>3313.78</td>
      <td>0</td>
      <td>1</td>
      <td>835.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54</th>
      <td>LL-I-11506719</td>
      <td>10cefd11d41612b032fd9cd2debe32dc</td>
      <td>1</td>
      <td>590.0</td>
      <td>2016-08-27 09:08:05.442</td>
      <td>2016-08-29 15:05:04.014</td>
      <td>0.0</td>
      <td>Paid Off Loan</td>
      <td>800.0</td>
      <td>2432.08</td>
      <td>10</td>
      <td>1</td>
      <td>624.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>577564</th>
      <td>LL-I-12367915</td>
      <td>55392b05f72f8c3e32e5157612406ba8</td>
      <td>1</td>
      <td>565.0</td>
      <td>2016-12-01 16:57:49.231</td>
      <td>2016-12-01 17:28:21.872</td>
      <td>3.0</td>
      <td>Paid Off Loan</td>
      <td>600.0</td>
      <td>1670.18</td>
      <td>0</td>
      <td>0</td>
      <td>693.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>577590</th>
      <td>LL-I-15280684</td>
      <td>73690518af906288434b2a0cfd972fe0</td>
      <td>3</td>
      <td>645.0</td>
      <td>2017-01-14 19:43:08.685</td>
      <td>2017-01-14 20:00:10.426</td>
      <td>0.0</td>
      <td>Paid Off Loan</td>
      <td>375.0</td>
      <td>1042.40</td>
      <td>25</td>
      <td>1</td>
      <td>700.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>577617</th>
      <td>LL-I-09897110</td>
      <td>0538f828b4a0b44502ead5a8033ee779</td>
      <td>1</td>
      <td>449.0</td>
      <td>2016-06-22 01:10:50.110</td>
      <td>2016-06-22 21:46:54.359</td>
      <td>0.0</td>
      <td>Paid Off Loan</td>
      <td>400.0</td>
      <td>664.12</td>
      <td>40</td>
      <td>1</td>
      <td>806.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>577653</th>
      <td>LL-I-14178923</td>
      <td>d9a63e9e15b862fcaaf3653c52e1f16c</td>
      <td>1</td>
      <td>625.0</td>
      <td>2016-12-30 15:49:39.785</td>
      <td>2016-12-30 16:00:12.500</td>
      <td>0.0</td>
      <td>New Loan</td>
      <td>600.0</td>
      <td>1868.88</td>
      <td>25</td>
      <td>1</td>
      <td>769.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>577662</th>
      <td>LL-I-13311312</td>
      <td>043dd86c24c63c8968082fa3ad7a8911</td>
      <td>0</td>
      <td>645.0</td>
      <td>2016-12-16 20:20:30.157</td>
      <td>2016-12-16 23:15:06.874</td>
      <td>0.0</td>
      <td>Paid Off Loan</td>
      <td>300.0</td>
      <td>1034.38</td>
      <td>6</td>
      <td>1</td>
      <td>827.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>38982 rows × 23 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-109802fa-0325-4455-b92a-6a8f23c945c1')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-109802fa-0325-4455-b92a-6a8f23c945c1 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-109802fa-0325-4455-b92a-6a8f23c945c1');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-dbe1885b-9b72-40c7-99f8-8325fb33b785">
  <button class="colab-df-quickchart" onclick="quickchart('df-dbe1885b-9b72-40c7-99f8-8325fb33b785')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-dbe1885b-9b72-40c7-99f8-8325fb33b785 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_617accce-ec03-4419-9fd5-6d8a7086b10f">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('df')"
            title="Generate code using this dataframe."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"/>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_617accce-ec03-4419-9fd5-6d8a7086b10f button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('df');
      }
      })();
    </script>
  </div>

    </div>
  </div>

</div>
</div>
<section id="feature-engineering" class="cell markdown"
id="yB8As4_Vkb04">
<h2>Feature Engineering</h2>
<p>Moving on, we'd now like to create a target variable to represent
whether a given loan application has defaulted or not. For this, we turn
to the <code>loanStatus</code> column, which gives us a high-level
overview of the outcomes of each application.</p>
</section>
<div class="cell code" data-execution_count="138"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="kDC0zg8ukb04" data-outputId="cb4486b1-ad56-4cbb-f563-a12fec176859">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a normalized count of unique values in loanStatus</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;loanStatus&#39;</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f&#39;</span><span class="sc">{</span>x <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="138">
<pre><code>Paid Off Loan                  29.31%
External Collection            29.07%
New Loan                       20.81%
Internal Collection            14.27%
Returned Item                   3.03%
Settlement Paid Off             1.82%
Settled Bankruptcy              0.83%
Pending Paid Off                0.43%
Charged Off Paid Off            0.41%
Charged Off                     0.00%
Settlement Pending Paid Off     0.00%
Name: loanStatus, dtype: object</code></pre>
</div>
</div>
<div class="cell markdown" id="n4ZdprAOkb04">
<p>We gather the following information:</p>
<ol>
<li><code>Paid Off Loan</code> and <code>Settlement Paid Off</code> seem
to indicate the loan was paid/settled in full, which are favorable
outcomes from the perspective of the lender (MoneyLion).</li>
<li><code>Settled Bankruptcy</code> and <code>Charged Off</code>
indicates the client failed to fulfill their financial obligations,
necessitating 3rd-party intervention &amp; a loss on MoneyLion's end.
These outcomes are what we're trying to avoid.</li>
<li>All other values indicate that the status of the loan is still
ongoing, and are thus irrelevant to our analyses.</li>
</ol>
<p>With that, we can create a new <code>target</code> column with a
binary value indicating whether <code>loanStatus</code> is favorable
(<code>target == 1</code>) or not (<code>target == 0</code>); we'll drop
all other entries.</p>
</div>
<div class="cell code" data-execution_count="139"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="UMDns2mCkb04" data-outputId="d6c892ee-7c8c-41dd-a4bb-123869d3f96b">
<div class="sourceCode" id="cb55"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Map loan status to target (0: loan default, 1: loan didn&#39;t default)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> target_encoding(x):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> {<span class="dv">0</span>: [<span class="st">&#39;Settled Bankruptcy&#39;</span>, <span class="st">&#39;Charged Off&#39;</span>],</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>: [<span class="st">&#39;Paid Off Loan&#39;</span>, <span class="st">&#39;Settlement Paid Off&#39;</span>]}</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, status <span class="kw">in</span> labels.items():</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="kw">in</span> status:</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> label</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;target&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;loanStatus&#39;</span>].<span class="bu">map</span>(target_encoding)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with no target label (implying their status is ongoing)</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">&#39;target&#39;</span>].notna()].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;target&#39;</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f&#39;</span><span class="sc">{</span>x <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="139">
<pre><code>1.0    97.38%
0.0     2.62%
Name: target, dtype: object</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="140"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:497}"
id="9vCVHyn10XBf" data-outputId="00e0fb59-d11e-4c08-eb3b-60ece7886685">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Class Imbalance Count plot</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar chart with customized styling</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;target&#39;</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">round</span>(x <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)).plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, color<span class="op">=</span><span class="st">&#39;seagreen&#39;</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the x and y axis labels</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Target variable&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Percentage of total data (%)&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the title</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Class Imbalance&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">&#39;bold&#39;</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the grid lines</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot to a file</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./class_imbalance.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/e8b29e3d845639960e89900a38fb28e19a97b7e9.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell markdown" id="SzlFBWD8kb04">
<p>Expectedly, we have a significant class imbalance against defaulted
loans, which we'll need to address during preprocessing.</p>
<p>Notice, we can now drop the <code>loanStatus</code> column, as we've
extracted &amp; summarized all the necessary information into
<code>target</code>.</p>
<p>We'll also choose to drop <code>hasCF</code>, since (1) we have no
information on what this column represents according to the attached
instructions, and (2) assuming "CF" stands for "clear fraud", one can
further assume that <code>clearfraudscore</code> already holds most of
the intrinsic information in <code>hasCF</code>, allowing us to safely
drop it from consideration (also recall our initial assumption that the
underwriting team will have rejected the majority of fraudulent
applications). Though, in a real-world scenario, it'd be best to ask for
clarification before doing so.</p>
</div>
<div class="cell code" data-execution_count="141" id="pewm7NJikb04">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop irrelevant columns</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">&#39;loanStatus&#39;</span>, <span class="st">&#39;hasCF&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell markdown" id="bR2nj1xMkb04">
<p>It remains to engineer additional features out of the available data.
Note the utility of taking an inventory of our current features, as to
better inform the feature engineering process:</p>
<ul>
<li><code>loan_id</code> &amp; <code>anon_ssn</code> can be used to
identify and track the client.</li>
<li><code>applicationDate</code> &amp; <code>originatedDate</code>
provide information on the timing of the loan.</li>
<li><code>loanAmount</code> &amp; <code>apr</code> provide information
on the cost of borrowing, which can be used to assess the affordability
of the loan.</li>
<li><code>payFrequency</code> &amp;
<code>originallyScheduledPaymentAmount</code> provide information on the
terms of the loan, which can be used to assess the client's ability to
make regular payments.</li>
<li><code>nPaidOff</code> provides information on the client's loan
repayment history, which is relevant to determining the client's
trustworthiness.</li>
<li><code>leadType</code> &amp; <code>leadCost</code> can provide
information on the source &amp; cost of obtaining the loan, which may be
relevant to assessing the quality of the loan.</li>
<li><code>clearfraudscore</code> can be used to identify and flag any
potential fraud.</li>
</ul>
<p>Based on this, a potential feature could be
<code>time_to_originate</code>, calculated from the difference between
<code>application_date</code> &amp; <code>originated_date</code>, in
hours. This can provide information on the time it took for the loan to
be originated, which may be relevant to assessing the quality of the
application.</p>
</div>
<div class="cell code" data-execution_count="142"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:330}"
id="QwDE2JAFkb04" data-outputId="9e311db9-84c5-4696-9f34-81bbebfde777">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate hours between applicationDate &amp; originatedDate</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;time_to_originate&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;originatedDate&#39;</span>] <span class="op">-</span> df[<span class="st">&#39;applicationDate&#39;</span>]).dt.seconds <span class="op">/</span> <span class="dv">3600</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="142">

  <div id="df-c8c7445d-77b4-4efa-a840-84d686815789" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>applicationDate</th>
      <th>originatedDate</th>
      <th>nPaidOff</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>leadCost</th>
      <th>clearfraudscore</th>
      <th>leadType_bvMandatory</th>
      <th>leadType_california</th>
      <th>leadType_express</th>
      <th>leadType_instant-offer</th>
      <th>leadType_lead</th>
      <th>leadType_lionpay</th>
      <th>leadType_organic</th>
      <th>leadType_prescreen</th>
      <th>leadType_rc_returning</th>
      <th>leadType_repeat</th>
      <th>target</th>
      <th>time_to_originate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LL-I-06644937</td>
      <td>464f5d9ae4fa09ece4048d949191865c</td>
      <td>1</td>
      <td>199.0</td>
      <td>2016-01-19 22:07:36.778</td>
      <td>2016-01-20 15:49:18.846</td>
      <td>0.0</td>
      <td>3000.0</td>
      <td>6395.19</td>
      <td>0</td>
      <td>879.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>17.695000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LL-I-16519347</td>
      <td>bc9fa73468acf18cb968a3a6a3c4697c</td>
      <td>2</td>
      <td>490.0</td>
      <td>2017-01-31 17:48:17.381</td>
      <td>2017-01-31 18:00:14.520</td>
      <td>2.0</td>
      <td>1250.0</td>
      <td>3313.78</td>
      <td>0</td>
      <td>835.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.199167</td>
    </tr>
    <tr>
      <th>2</th>
      <td>LL-I-11506719</td>
      <td>10cefd11d41612b032fd9cd2debe32dc</td>
      <td>1</td>
      <td>590.0</td>
      <td>2016-08-27 09:08:05.442</td>
      <td>2016-08-29 15:05:04.014</td>
      <td>0.0</td>
      <td>800.0</td>
      <td>2432.08</td>
      <td>10</td>
      <td>624.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>5.949444</td>
    </tr>
    <tr>
      <th>3</th>
      <td>LL-I-09279047</td>
      <td>1d249e27292d25e4d3b4bc142a2a4aea</td>
      <td>0</td>
      <td>404.1</td>
      <td>2016-05-25 03:05:18.849</td>
      <td>2016-05-25 15:11:36.260</td>
      <td>3.0</td>
      <td>300.0</td>
      <td>422.64</td>
      <td>0</td>
      <td>770.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>12.104722</td>
    </tr>
    <tr>
      <th>4</th>
      <td>LL-I-01316580</td>
      <td>2a10b2e04c5eec9a47a8cf5b9b81a2b8</td>
      <td>0</td>
      <td>590.0</td>
      <td>2015-05-26 17:02:27.312</td>
      <td>2015-05-26 18:45:48.024</td>
      <td>0.0</td>
      <td>300.0</td>
      <td>896.87</td>
      <td>6</td>
      <td>693.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.722222</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-c8c7445d-77b4-4efa-a840-84d686815789')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-c8c7445d-77b4-4efa-a840-84d686815789 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-c8c7445d-77b4-4efa-a840-84d686815789');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-2648bc77-221d-454a-b754-3ce29ed8c729">
  <button class="colab-df-quickchart" onclick="quickchart('df-2648bc77-221d-454a-b754-3ce29ed8c729')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-2648bc77-221d-454a-b754-3ce29ed8c729 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="lHS7JwcGkb04">
<p>Another useful feature is <code>time_since_last</code>, which
represents the time between consecutive loan applications by a given
person, in days. For non-returning clients, this value will be -1.</p>
</div>
<div class="cell code" data-execution_count="143"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:330}"
id="6WZcEukOkb04" data-outputId="6d5e4b57-9b10-4297-9c4b-b18787e6d493">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of df and sort the values by ssn &amp; applicationDate</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> df.sort_values(by<span class="op">=</span>[<span class="st">&#39;anon_ssn&#39;</span>, <span class="st">&#39;applicationDate&#39;</span>]).copy()</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the days between consecutive applications</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;time_since_last&#39;</span>] <span class="op">=</span> tmp.groupby(<span class="st">&#39;anon_ssn&#39;</span>)[<span class="st">&#39;applicationDate&#39;</span>].diff().dt.total_seconds() <span class="op">/</span> (<span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill NaN values</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;time_since_last&#39;</span>] <span class="op">=</span> df[<span class="st">&#39;time_since_last&#39;</span>].fillna(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="143">

  <div id="df-b93a1ec8-152a-4b50-b41c-ebf140199e29" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>applicationDate</th>
      <th>originatedDate</th>
      <th>nPaidOff</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>leadCost</th>
      <th>clearfraudscore</th>
      <th>leadType_bvMandatory</th>
      <th>leadType_california</th>
      <th>leadType_express</th>
      <th>leadType_instant-offer</th>
      <th>leadType_lead</th>
      <th>leadType_lionpay</th>
      <th>leadType_organic</th>
      <th>leadType_prescreen</th>
      <th>leadType_rc_returning</th>
      <th>leadType_repeat</th>
      <th>target</th>
      <th>time_to_originate</th>
      <th>time_since_last</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LL-I-06644937</td>
      <td>464f5d9ae4fa09ece4048d949191865c</td>
      <td>1</td>
      <td>199.0</td>
      <td>2016-01-19 22:07:36.778</td>
      <td>2016-01-20 15:49:18.846</td>
      <td>0.0</td>
      <td>3000.0</td>
      <td>6395.19</td>
      <td>0</td>
      <td>879.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>17.695000</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LL-I-16519347</td>
      <td>bc9fa73468acf18cb968a3a6a3c4697c</td>
      <td>2</td>
      <td>490.0</td>
      <td>2017-01-31 17:48:17.381</td>
      <td>2017-01-31 18:00:14.520</td>
      <td>2.0</td>
      <td>1250.0</td>
      <td>3313.78</td>
      <td>0</td>
      <td>835.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.199167</td>
      <td>13.688801</td>
    </tr>
    <tr>
      <th>2</th>
      <td>LL-I-11506719</td>
      <td>10cefd11d41612b032fd9cd2debe32dc</td>
      <td>1</td>
      <td>590.0</td>
      <td>2016-08-27 09:08:05.442</td>
      <td>2016-08-29 15:05:04.014</td>
      <td>0.0</td>
      <td>800.0</td>
      <td>2432.08</td>
      <td>10</td>
      <td>624.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>5.949444</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>LL-I-09279047</td>
      <td>1d249e27292d25e4d3b4bc142a2a4aea</td>
      <td>0</td>
      <td>404.1</td>
      <td>2016-05-25 03:05:18.849</td>
      <td>2016-05-25 15:11:36.260</td>
      <td>3.0</td>
      <td>300.0</td>
      <td>422.64</td>
      <td>0</td>
      <td>770.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>12.104722</td>
      <td>98.405253</td>
    </tr>
    <tr>
      <th>4</th>
      <td>LL-I-01316580</td>
      <td>2a10b2e04c5eec9a47a8cf5b9b81a2b8</td>
      <td>0</td>
      <td>590.0</td>
      <td>2015-05-26 17:02:27.312</td>
      <td>2015-05-26 18:45:48.024</td>
      <td>0.0</td>
      <td>300.0</td>
      <td>896.87</td>
      <td>6</td>
      <td>693.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.722222</td>
      <td>-1.000000</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-b93a1ec8-152a-4b50-b41c-ebf140199e29')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-b93a1ec8-152a-4b50-b41c-ebf140199e29 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-b93a1ec8-152a-4b50-b41c-ebf140199e29');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-df4831a6-e5b1-40dd-8dd3-aa34cd2c9a11">
  <button class="colab-df-quickchart" onclick="quickchart('df-df4831a6-e5b1-40dd-8dd3-aa34cd2c9a11')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-df4831a6-e5b1-40dd-8dd3-aa34cd2c9a11 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="kZ38bz8akb04">
<p>One could also choose a feature like
<code>num_previous_funded_loans</code>, indicating how many previously
funded loans a client has had with MoneyLion in the past, at the time of
the application. Though, upon closer inspection, we notice there are
some missing entries.</p>
<p>For example, the following client is missing loans #0, #6, #10, and
#14.</p>
</div>
<div class="cell code" data-execution_count="144"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:671}"
id="_Fgye34akb04" data-outputId="f03be0a4-7883-4481-a1cf-98e69161803a">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: this ssn has the most entries on-file</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">&#39;anon_ssn&#39;</span>] <span class="op">==</span> <span class="st">&#39;228060b9cc8af6a937d0321122d459f3&#39;</span>].sort_values(by<span class="op">=</span>[<span class="st">&#39;applicationDate&#39;</span>])</span></code></pre></div>
<div class="output execute_result" data-execution_count="144">

  <div id="df-0de56545-c8d7-4537-8536-8cfd35da9f8d" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>applicationDate</th>
      <th>originatedDate</th>
      <th>nPaidOff</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>leadCost</th>
      <th>clearfraudscore</th>
      <th>leadType_bvMandatory</th>
      <th>leadType_california</th>
      <th>leadType_express</th>
      <th>leadType_instant-offer</th>
      <th>leadType_lead</th>
      <th>leadType_lionpay</th>
      <th>leadType_organic</th>
      <th>leadType_prescreen</th>
      <th>leadType_rc_returning</th>
      <th>leadType_repeat</th>
      <th>target</th>
      <th>time_to_originate</th>
      <th>time_since_last</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11296</th>
      <td>LL-I-04012560</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2015-10-23 14:56:26.973</td>
      <td>2015-10-23 15:41:41.837</td>
      <td>1.0</td>
      <td>800.0</td>
      <td>1722.75</td>
      <td>0</td>
      <td>614.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.753889</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>3067</th>
      <td>LL-I-04358754</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2015-11-05 19:28:54.692</td>
      <td>2015-11-05 19:47:35.596</td>
      <td>2.0</td>
      <td>800.0</td>
      <td>1318.06</td>
      <td>0</td>
      <td>614.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.311111</td>
      <td>13.189210</td>
    </tr>
    <tr>
      <th>4506</th>
      <td>LL-I-05205561</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2015-12-01 21:44:50.958</td>
      <td>2015-12-02 15:22:55.320</td>
      <td>3.0</td>
      <td>800.0</td>
      <td>1389.67</td>
      <td>0</td>
      <td>693.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>17.634444</td>
      <td>26.094401</td>
    </tr>
    <tr>
      <th>3101</th>
      <td>LL-I-06837849</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2016-01-27 16:52:33.451</td>
      <td>2016-01-27 18:07:50.283</td>
      <td>4.0</td>
      <td>800.0</td>
      <td>1359.82</td>
      <td>0</td>
      <td>614.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.254444</td>
      <td>56.797020</td>
    </tr>
    <tr>
      <th>1012</th>
      <td>LL-I-08384112</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2016-04-04 14:07:52.556</td>
      <td>2016-04-05 18:18:39.840</td>
      <td>5.0</td>
      <td>800.0</td>
      <td>1449.38</td>
      <td>0</td>
      <td>614.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>4.179722</td>
      <td>67.885638</td>
    </tr>
    <tr>
      <th>10786</th>
      <td>LL-I-09327212</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>404.10</td>
      <td>2016-05-26 19:57:32.706</td>
      <td>2016-05-26 21:23:45.516</td>
      <td>7.0</td>
      <td>600.0</td>
      <td>957.95</td>
      <td>0</td>
      <td>614.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.436667</td>
      <td>52.242826</td>
    </tr>
    <tr>
      <th>9159</th>
      <td>LL-I-10053275</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>404.10</td>
      <td>2016-06-30 15:14:52.727</td>
      <td>2016-06-30 19:08:44.701</td>
      <td>8.0</td>
      <td>400.0</td>
      <td>692.24</td>
      <td>0</td>
      <td>614.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>3.897500</td>
      <td>34.803704</td>
    </tr>
    <tr>
      <th>4292</th>
      <td>LL-I-10680938</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2016-07-30 20:19:50.936</td>
      <td>2016-07-31 16:11:46.279</td>
      <td>9.0</td>
      <td>1000.0</td>
      <td>1811.70</td>
      <td>0</td>
      <td>752.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>19.865278</td>
      <td>30.211785</td>
    </tr>
    <tr>
      <th>5282</th>
      <td>LL-I-11629173</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2016-08-31 02:54:39.904</td>
      <td>2016-08-31 15:02:27.824</td>
      <td>11.0</td>
      <td>1000.0</td>
      <td>2051.77</td>
      <td>0</td>
      <td>752.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>12.129722</td>
      <td>31.274178</td>
    </tr>
    <tr>
      <th>7016</th>
      <td>LL-I-12081344</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2016-09-28 15:53:32.914</td>
      <td>2016-09-28 20:07:49.891</td>
      <td>12.0</td>
      <td>1000.0</td>
      <td>1664.27</td>
      <td>0</td>
      <td>752.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>4.237778</td>
      <td>28.540891</td>
    </tr>
    <tr>
      <th>3594</th>
      <td>LL-I-12120038</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2016-11-05 16:24:17.676</td>
      <td>2016-11-07 23:06:08.769</td>
      <td>13.0</td>
      <td>1000.0</td>
      <td>2640.41</td>
      <td>0</td>
      <td>752.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>6.697500</td>
      <td>38.021351</td>
    </tr>
    <tr>
      <th>1722</th>
      <td>LL-I-16760104</td>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>1</td>
      <td>449.99</td>
      <td>2017-02-06 10:12:49.225</td>
      <td>2017-02-06 10:30:14.234</td>
      <td>15.0</td>
      <td>400.0</td>
      <td>1048.73</td>
      <td>0</td>
      <td>693.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.290278</td>
      <td>92.742032</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-0de56545-c8d7-4537-8536-8cfd35da9f8d')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-0de56545-c8d7-4537-8536-8cfd35da9f8d button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-0de56545-c8d7-4537-8536-8cfd35da9f8d');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-2cfe4019-57c8-4f7e-919e-74b57d5ee959">
  <button class="colab-df-quickchart" onclick="quickchart('df-2cfe4019-57c8-4f7e-919e-74b57d5ee959')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-2cfe4019-57c8-4f7e-919e-74b57d5ee959 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="iugOtPs2kb0_">
<p>More explicitly, create a temporary column <code>loan_count</code>
with the values one would expect without prior knowledge about the
missing entries, and juxtapose it with <code>nPaidOff</code>.</p>
</div>
<div class="cell code" data-execution_count="145"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:425}"
id="qBWwHyygkb0_" data-outputId="7b40e977-5dfc-492f-d24a-6c33c5f87548">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of distinct loan IDs up to (&amp; excluding) the current application date</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> df.copy()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> tmp.sort_values(by<span class="op">=</span>[<span class="st">&#39;anon_ssn&#39;</span>, <span class="st">&#39;applicationDate&#39;</span>])</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>tmp[<span class="st">&#39;loan_count&#39;</span>] <span class="op">=</span> tmp.groupby([<span class="st">&#39;anon_ssn&#39;</span>])[<span class="st">&#39;loanId&#39;</span>].cumcount()</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>tmp[tmp[<span class="st">&#39;anon_ssn&#39;</span>] <span class="op">==</span> <span class="st">&#39;228060b9cc8af6a937d0321122d459f3&#39;</span>][[<span class="st">&#39;anon_ssn&#39;</span>, <span class="st">&#39;loanId&#39;</span>,<span class="st">&#39;nPaidOff&#39;</span>, <span class="st">&#39;loan_count&#39;</span>]]</span></code></pre></div>
<div class="output execute_result" data-execution_count="145">

  <div id="df-e301ac3d-15e9-41ca-908f-030ffce34ec9" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>anon_ssn</th>
      <th>loanId</th>
      <th>nPaidOff</th>
      <th>loan_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>11296</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-04012560</td>
      <td>1.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3067</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-04358754</td>
      <td>2.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4506</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-05205561</td>
      <td>3.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3101</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-06837849</td>
      <td>4.0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1012</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-08384112</td>
      <td>5.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>10786</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-09327212</td>
      <td>7.0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9159</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-10053275</td>
      <td>8.0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4292</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-10680938</td>
      <td>9.0</td>
      <td>7</td>
    </tr>
    <tr>
      <th>5282</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-11629173</td>
      <td>11.0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>7016</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-12081344</td>
      <td>12.0</td>
      <td>9</td>
    </tr>
    <tr>
      <th>3594</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-12120038</td>
      <td>13.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1722</th>
      <td>228060b9cc8af6a937d0321122d459f3</td>
      <td>LL-I-16760104</td>
      <td>15.0</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-e301ac3d-15e9-41ca-908f-030ffce34ec9')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-e301ac3d-15e9-41ca-908f-030ffce34ec9 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-e301ac3d-15e9-41ca-908f-030ffce34ec9');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-59537588-c829-4df4-99f8-8c408245a7a4">
  <button class="colab-df-quickchart" onclick="quickchart('df-59537588-c829-4df4-99f8-8c408245a7a4')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-59537588-c829-4df4-99f8-8c408245a7a4 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="drq1ncWtkb0_">
<p>Thus, due to the discrepancy, we'll refrain from using
<code>num_previous_funded_loans</code> as a feature.</p>
<p>In fact, in the interest of time, we'll assume our currently
implemented features will suffice. For further discussion regarding
potential new data/features, see the "Further Work" section.</p>
</div>
<div class="cell code" data-execution_count="146"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:320}"
id="_0TFF_6Rkb0_" data-outputId="56c777de-86af-4167-8b63-00bb32cf5cb3">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a copy for exploratory analysis/visualization</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> df.copy()</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print descriptive stats for numeric columns</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>data[[<span class="st">&#39;apr&#39;</span>, <span class="st">&#39;nPaidOff&#39;</span>, <span class="st">&#39;loanAmount&#39;</span>, <span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>, <span class="st">&#39;leadCost&#39;</span>, <span class="st">&#39;clearfraudscore&#39;</span>, <span class="st">&#39;time_to_originate&#39;</span>, <span class="st">&#39;time_since_last&#39;</span>]].describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="146">

  <div id="df-7221a7be-8ff8-453c-a4ba-b26382b9073a" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>apr</th>
      <th>nPaidOff</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>leadCost</th>
      <th>clearfraudscore</th>
      <th>time_to_originate</th>
      <th>time_since_last</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>12461.000000</td>
      <td>12461.000000</td>
      <td>12461.000000</td>
      <td>12461.000000</td>
      <td>12461.000000</td>
      <td>12461.000000</td>
      <td>12461.000000</td>
      <td>12461.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>508.946662</td>
      <td>0.590081</td>
      <td>629.297007</td>
      <td>1661.688210</td>
      <td>12.109863</td>
      <td>709.577482</td>
      <td>7.040876</td>
      <td>26.693385</td>
    </tr>
    <tr>
      <th>std</th>
      <td>117.319897</td>
      <td>1.389716</td>
      <td>451.761168</td>
      <td>1202.830803</td>
      <td>24.749500</td>
      <td>115.983220</td>
      <td>7.638825</td>
      <td>72.233430</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>100.000000</td>
      <td>188.410000</td>
      <td>0.000000</td>
      <td>177.000000</td>
      <td>0.000000</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>390.000000</td>
      <td>0.000000</td>
      <td>350.000000</td>
      <td>950.230000</td>
      <td>0.000000</td>
      <td>655.000000</td>
      <td>0.715000</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>565.000000</td>
      <td>0.000000</td>
      <td>500.000000</td>
      <td>1303.620000</td>
      <td>3.000000</td>
      <td>693.000000</td>
      <td>3.221111</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>590.000000</td>
      <td>1.000000</td>
      <td>700.000000</td>
      <td>1943.700000</td>
      <td>10.000000</td>
      <td>794.000000</td>
      <td>13.698611</td>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>705.590000</td>
      <td>21.000000</td>
      <td>4687.000000</td>
      <td>12550.080000</td>
      <td>200.000000</td>
      <td>961.000000</td>
      <td>23.998333</td>
      <td>608.884541</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-7221a7be-8ff8-453c-a4ba-b26382b9073a')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-7221a7be-8ff8-453c-a4ba-b26382b9073a button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-7221a7be-8ff8-453c-a4ba-b26382b9073a');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-8af7fb82-f627-4d66-8269-0a50964c7b39">
  <button class="colab-df-quickchart" onclick="quickchart('df-8af7fb82-f627-4d66-8269-0a50964c7b39')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-8af7fb82-f627-4d66-8269-0a50964c7b39 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell markdown" id="-AwEJ_p2kb0_">
<p>Already, we see that the average funded loan at MoneyLion is for
$629.30 in principal, at an APR of 5.089% (assuming the data are
expressed in basis points), with an expected payment amount of $1661.69.
Additionally, the average funded loan application takes 7.04 days to
originate, and receives a clear fraud score of 709.58 from the
underwriting team.</p>
<p>However, without prior knowledge of how these data are distributed,
it's difficult to tell how useful these statistics truly are.</p>
<p>Subsequently, we move on to the features concerning the terms of the
loans.</p>
</div>
<div class="cell code" data-execution_count="147"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:536}"
id="ZrhmHNX6kb0_" data-outputId="fedb237f-cf47-46e5-8b3c-ff1ef6dc2d11">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Loan Status Count Plot</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the second graph</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;target&#39;</span>].value_counts().plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, color<span class="op">=</span><span class="st">&#39;maroon&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;Loan Status&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels([<span class="st">&#39;No default&#39;</span>, <span class="st">&#39;Default&#39;</span>], fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/0b01b0d6286719ba66352f38389bfb6ae280d86d.png" /></p>
</div>
</div>
<div class="cell markdown" id="k_x1HMRckb0_">
<p>We notice the majority of funded loan applications follow either a
weekly or bi-weekly repayment schedule.</p>
</div>
<div class="cell code" data-execution_count="148" id="sR0EXgctkb1A">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform aggregations</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;application_year&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;applicationDate&#39;</span>].dt.year</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;application_month&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;applicationDate&#39;</span>].dt.month</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;application_day&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;applicationDate&#39;</span>].dt.day</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;application_day_of_week&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;applicationDate&#39;</span>].dt.day_of_week</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;application_quarter&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;applicationDate&#39;</span>].dt.quarter</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>days <span class="op">=</span> {<span class="dv">0</span>: <span class="st">&#39;M&#39;</span>, <span class="dv">1</span>: <span class="st">&#39;T&#39;</span>, <span class="dv">2</span>: <span class="st">&#39;W&#39;</span>, <span class="dv">3</span>: <span class="st">&#39;R&#39;</span>, <span class="dv">4</span>: <span class="st">&#39;F&#39;</span>, <span class="dv">5</span>: <span class="st">&#39;S&#39;</span>, <span class="dv">6</span>: <span class="st">&#39;SS&#39;</span>}</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>data[<span class="st">&#39;application_day_of_week&#39;</span>] <span class="op">=</span> data[<span class="st">&#39;application_day_of_week&#39;</span>].<span class="bu">map</span>(days)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="149"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="lQRbDrJhXsP5" data-outputId="3188f65c-5848-4c3a-d1a7-d49367f22485">
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Yearly Applications Countplot</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the style for a visually appealing look</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">&quot;whitegrid&quot;</span>, palette<span class="op">=</span><span class="st">&quot;pastel&quot;</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for Yearly Applications</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;application_year&#39;</span>, data<span class="op">=</span>data, palette<span class="op">=</span><span class="st">&#39;Blues_d&#39;</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Yearly Applications&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>sns.despine()  <span class="co"># Remove the spines for a cleaner look</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./yearly_applications.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/b239cf471cc1fbfcc7309f31623a22636736b20e.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="150"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="LLtgetOBXzy7" data-outputId="19b880b5-4b05-4236-c014-6804ca39600e">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Monthly Applications Countplot</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;application_month&#39;</span>, data<span class="op">=</span>data, palette<span class="op">=</span><span class="st">&#39;Oranges_d&#39;</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Monthly Applications&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./monthly_applications.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/2447ee383d89cfe83690f142a6e0e5da41e55e6d.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="151"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="kO62U_htX6_A" data-outputId="ca1232d2-7856-4ebb-c4e6-395457a2c933">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Daily Applications Countplot</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;application_day&#39;</span>, data<span class="op">=</span>data, palette<span class="op">=</span><span class="st">&#39;Greens_d&#39;</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Daily Applications&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./daily_applications.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/5c26b003c7966d6bd00f64fc52ae962f9852e7c9.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="152"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="5Bix0UovYAWh" data-outputId="7a81146f-6f8c-4c4e-d6fc-1199b9e5521e">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Weekday Applications Countplot</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>order <span class="op">=</span>[<span class="st">&#39;M&#39;</span>, <span class="st">&#39;T&#39;</span>, <span class="st">&#39;W&#39;</span>, <span class="st">&#39;R&#39;</span>, <span class="st">&#39;F&#39;</span>, <span class="st">&#39;S&#39;</span>, <span class="st">&#39;SS&#39;</span>]  <span class="co"># Use full names for clarity</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;application_day_of_week&#39;</span>, data<span class="op">=</span>data, order<span class="op">=</span>order, palette<span class="op">=</span><span class="st">&#39;Purples_d&#39;</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Weekday Applications&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./weekday_applications.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/b09ffd8a2dafdb1330b6b8a9787538732aa75c42.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="153"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:401}"
id="eX0AoplyYJoN" data-outputId="3cbd98a0-c388-48c0-99ce-1c061a04761e">
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Quarterly Applications Countplot</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>sns.countplot(x<span class="op">=</span><span class="st">&#39;application_quarter&#39;</span>, data<span class="op">=</span>data, palette<span class="op">=</span><span class="st">&#39;Reds_d&#39;</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Quarterly Applications&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./quarterly_applications.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/ebf01d060f7f539be8d146f33f2eb9e723ab7638.png" /></p>
</div>
</div>
<div class="cell markdown" id="TjQEp8rRksxG">
<p>#Observations:</p>
<ol>
<li><p>This histogram shows the number of applications per year from
2014 to 2017. There's an increasing trend in applications each year,
with a significant jump in 2016 followed by a decrease in 2017.</p></li>
<li><p>This bar chart presents monthly applications within a single year
(the year isn't specified in the plot). It appears that there is a
general trend of increasing applications toward the latter months of the
year, with a peak in the last month.</p></li>
<li><p>This histogram breaks down the number of applications by day of
the month. The distribution seems fairly uniform, with slight
variations, which may be normal given that the number of days in months
varies, and there might be more applications on specific days due to
payday cycles or marketing campaigns.</p></li>
<li><p>The bar chart illustrates the number of applications by weekdays.
It shows a relatively even distribution across the days, with perhaps a
slight drop on Friday. This may suggest that people apply for loans
uniformly throughout the workweek.</p></li>
<li><p>Finally, the bar chart representing quarterly applications shows
the count of applications per quarter in a year. There is a visible
increase in applications in the final quarter.</p></li>
</ol>
</div>
<div class="cell code" data-execution_count="154"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:601}"
id="pg2dWRJLlIrA" data-outputId="78d22a5a-8d08-44c0-fadd-14f7e7515b68">
<div class="sourceCode" id="cb72"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Time to Originate Countplot</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the aesthetic style of the plots</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;whitegrid&#39;</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&#39;pastel&#39;</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for Time to Originate</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[<span class="st">&#39;time_to_originate&#39;</span>], bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span><span class="st">&#39;lightgrey&#39;</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Time to Originate Distribution&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Time to Originate (hours)&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>sns.despine()  <span class="co"># Remove the spines for a cleaner look</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout and display the plot</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure to your local machine if needed</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig(&#39;./time_to_originate_distribution.png&#39;, format=&#39;png&#39;)</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/9fd4d18f8101126ccb4d38d944b348b216bbb422.png" /></p>
</div>
</div>
<div class="cell markdown" id="GV9iwql5mpuA">
<ol>
<li><p>The distribution is right-skewed, meaning that most loans are
originated within a few hours after application, but there are some
cases where the origination process takes significantly longer.</p></li>
<li><p>The mode (the highest bar on the histogram, representing the most
common value range) is at or near zero, suggesting that a large number
of loans are originated very quickly, possibly automatically or with a
very streamlined process.</p></li>
<li><p>The long tail to the right indicates that while it's less common,
some loans take much longer to originate. This could be due to more
complex verification processes, the need for manual review, or other
factors that delay the origination.</p></li>
</ol>
<p>This distribution is useful for understanding how efficient the loan
origination process is. If a loan prediction model is being developed,
this information might help in predicting the time it will take for a
new application to move from application to origination.</p>
</div>
<div class="cell code" data-execution_count="155"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:601}"
id="tlFeJZMllWts" data-outputId="979f5d8d-540f-4eb8-b726-3df57ced7f7e">
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Time Between Applications Distribution Countplot</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the aesthetic style of the plots</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">&#39;whitegrid&#39;</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">&#39;pastel&#39;</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram for Time Since Last for Returning Applications</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>sns.histplot(data[data[<span class="st">&#39;time_since_last&#39;</span>] <span class="op">&gt;=</span> <span class="dv">0</span>][<span class="st">&#39;time_since_last&#39;</span>], bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span><span class="st">&#39;lightgreen&#39;</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Time Between Applications Distribution&#39;</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Days Between Applications&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Count&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>sns.despine()  <span class="co"># Remove the spines for a cleaner look</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the layout and display the plot</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure to your local machine if needed</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig(&#39;./time_since_last_distribution.png&#39;, format=&#39;png&#39;)</span></span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/cc5dd3c0133314dfcae192ffefb6059b99dd99a2.png" /></p>
</div>
</div>
<div class="cell markdown" id="7mgha9icscd5">
<ol>
<li><p>The distribution is right-skewed, meaning that most returning
clients submit another successful application roughly 200 days after
their last, but there are some cases where the time between applications
is significantly shorter or longer.</p></li>
<li><p>The mode (the highest bar on the histogram, representing the most
common value range) is at or near 200, suggesting that a large number of
returning clients submit new applications around that time
frame.</p></li>
<li><p>The long tail to the right indicates that while it's less common,
some returning clients submit new applications much sooner or later than
200 days after their last.</p></li>
</ol>
<p>This distribution is useful for understanding the typical behavior of
returning clients and their tendency to reapply for loans. If a loan
prediction model is being developed, this information might help in
predicting the likelihood of a returning client applying for a new loan
within a certain time frame.</p>
</div>
<div class="cell markdown" id="6W4_5XKnsFwF">

</div>
<div class="cell code" data-execution_count="156"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:841}"
id="ZWFKZ03HqTcG" data-outputId="c28b59c9-2e19-42ca-ce25-8493cb758705">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Correlation Heatmap</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))  <span class="co"># Slightly adjusted for better aspect ratio</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap Generation with Tweaks</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>corr_heatmap <span class="op">=</span> sns.heatmap(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    df.corr(),</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>,  <span class="co"># Enforce consistent color range</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>,  <span class="co"># Diverging colormap to highlight positive/negative correlations</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">True</span>,        <span class="co"># Display correlation values</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    annot_kws<span class="op">=</span>{<span class="st">&quot;fontsize&quot;</span>: <span class="dv">12</span>},  <span class="co"># Slightly smaller font for readability</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">=</span><span class="st">&#39;.2f&#39;</span>,        <span class="co"># Formatting of annotations</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.5</span>,   <span class="co"># Thin grid lines</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    linecolor<span class="op">=</span><span class="st">&#39;white&#39;</span>, <span class="co"># White grid lines for contrast</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">&quot;shrink&quot;</span>: <span class="fl">0.8</span>}  <span class="co"># Adjust colorbar size</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Labeling and Layout</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>corr_heatmap.set_xticklabels(corr_heatmap.get_xticklabels(), rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">&#39;right&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>corr_heatmap.set_yticklabels(corr_heatmap.get_yticklabels(), fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> corr_heatmap.collections[<span class="dv">0</span>].colorbar</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>cbar.ax.tick_params(labelsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Correlation Heatmap&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)  <span class="co"># Add title</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Save and Show</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./correlation_heatmap.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>, dpi<span class="op">=</span><span class="dv">300</span>) <span class="co"># Higher DPI for sharper image</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/591d99ec8fb68b5638294545b4b5b2ea3b8a86a5.png" /></p>
</div>
</div>
<div class="cell markdown" id="QvkJLoZxtD_t">
<p>From the correlation heatmap, we can derive the following
insights:</p>
<ol>
<li><strong>Positive Correlations:</strong>
<ul>
<li><code>loanAmount</code> and
<code>originallyScheduledPaymentAmount</code> have a strong positive
correlation (0.94), indicating that as the loan amount increases, the
scheduled payment amount tends to increase as well.</li>
</ul></li>
<li><strong>Negative Correlations:</strong>
<ul>
<li><code>time_to_originate</code> has a moderate negative correlation
with <code>loanAmount</code> (-0.33) and
<code>originallyScheduledPaymentAmount</code> (-0.32), suggesting that
loans with higher amounts may take longer to originate.</li>
<li><code>time_since_last</code> has a weak negative correlation with
<code>loanAmount</code> (-0.14) and
<code>originallyScheduledPaymentAmount</code> (-0.13), indicating that
returning clients may tend to apply for smaller loans than new
clients.</li>
</ul></li>
<li><strong>Weak Correlations:</strong>
<ul>
<li><code>target</code> (loan default status) does not have any strong
correlations with any of the features, suggesting that the features
included in the analysis may not be sufficient to accurately predict
loan defaults.</li>
</ul></li>
<li><strong>Multicollinearity:</strong>
<ul>
<li>The high correlation between <code>loanAmount</code> and
<code>originallyScheduledPaymentAmount</code> may indicate
multicollinearity, which can potentially affect the stability and
interpretability of regression models.</li>
</ul></li>
</ol>
</div>
<section id="preprocessing" class="cell markdown" id="J4v7sywYkb1A">
<h1>Preprocessing</h1>
<p>Now that we have a good grasp of the data, we can begin preparing it
for training.</p>
<p>We start by dropping applicationDate &amp; originatedDate from our
list of features, with the justifications that:</p>
<ol>
<li>there are no clear &amp; obvious trends in the
application/originated dates.</li>
<li>there is no reason to believe these dates on their own can indicate
the outcome of a loan.</li>
<li>we've already aggregated the time-contextual data into
time_to_originate and time_since_last.</li>
</ol>
</section>
<div class="cell code" data-execution_count="157" id="74uGdbwzkb1A">
<div class="sourceCode" id="cb75"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop irrelevant columns</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">&#39;applicationDate&#39;</span>, <span class="st">&#39;originatedDate&#39;</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<section id="31-scalingnormalization" class="cell markdown"
id="C1r2Mjn-kb1A">
<h2>3.1 Scaling/Normalization</h2>
<p>Next, to prevent any one feature from dominating the others, we
perform scaling/normalization on the numeric features (excluding binary
&amp; one-hot encoded features). More specifically, we apply</p>
<ul>
<li>min-max scaling to the features containing outliers
(<code>loanAmount</code>,
<code>originallyScheduledPaymentAmount</code>)</li>
<li>z-score standardization on the features whose Gaussianity we want to
preserve (<code>clearfraudscore</code>)</li>
<li>box-cox transformation to the positively skewed features
(<code>nPaidOff</code>, <code>time_to_originate</code>,
<code>leadCost</code>)</li>
<li>logarithmic transform on the features with bimodal distributions
(<code>apr</code>, <code>time_since_last</code>)</li>
</ul>
<p>Note that because <code>time_since_last</code> uses -1 inplace of
<code>NaN</code> values, we'll only normalize the positive values in the
column.</p>
</section>
<div class="cell code" data-execution_count="158" id="HRQUwbP9kb1A">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Min-max scaling</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&#39;loanAmount&#39;</span>, <span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>]] <span class="op">=</span> scaler.fit_transform(df[[<span class="st">&#39;loanAmount&#39;</span>, <span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>]])</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Z-score standardization</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>mean, stdev <span class="op">=</span> df[<span class="st">&#39;clearfraudscore&#39;</span>].mean(), df[<span class="st">&#39;clearfraudscore&#39;</span>].std()</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;clearfraudscore&#39;</span>] <span class="op">=</span> (df[<span class="st">&#39;clearfraudscore&#39;</span>] <span class="op">-</span> mean) <span class="op">/</span> stdev</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Box-cox transformation</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">&#39;nPaidOff&#39;</span>, <span class="st">&#39;time_to_originate&#39;</span>, <span class="st">&#39;leadCost&#39;</span>]</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> cols:</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>    df[col], _ <span class="op">=</span> boxcox(df[col] <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Logarithmic transform</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;apr&#39;</span>] <span class="op">=</span> np.log(df[<span class="st">&#39;apr&#39;</span>])</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> df[<span class="st">&#39;time_since_last&#39;</span>] <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>df.loc[mask, <span class="st">&#39;time_since_last&#39;</span>] <span class="op">=</span> np.log(df.loc[mask, <span class="st">&#39;time_since_last&#39;</span>])</span></code></pre></div>
</div>
<div class="cell markdown" id="M6zC4dOBkb1A">
<p>From the above RuntimeWarning, we uncover that the application with
loan ID <code>LL-I-00526002</code> had an APR of 0 to begin with,
leading to an <code>-inf</code> value post-log transform. Similarly, the
client with SSN <code>7edc6acb596c64104d96b3d6897d2aed</code> made 2
simultaneous applications on <code>2015-02-20 17:16:24.718</code>, both
of which were also originated simultaneously on
<code>2015-02-20 19:40:33.329</code>, implying a
<code>time_since_last</code> value of 0 (and a post-log transform value
of <code>-inf</code>).</p>
</div>
<div class="cell markdown" id="Ft2-Ivczkb1A">
<p>Since both datapoints contain questionable logic, we'll drop them
from the dataframe.</p>
</div>
<div class="cell code" data-execution_count="159"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:184}"
id="c6SQrbLItzMU" data-outputId="7d4b0d05-4052-47ee-c4e2-714a0a9109e8">
<div class="sourceCode" id="cb77"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># after normalization: -Inf</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>df.iloc[[<span class="dv">9299</span>, <span class="dv">10086</span>]]</span></code></pre></div>
<div class="output execute_result" data-execution_count="159">

  <div id="df-acdfb22a-444f-44ba-926d-3574fd10cb17" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanId</th>
      <th>anon_ssn</th>
      <th>payFrequency</th>
      <th>apr</th>
      <th>nPaidOff</th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>leadCost</th>
      <th>clearfraudscore</th>
      <th>leadType_bvMandatory</th>
      <th>leadType_california</th>
      <th>leadType_express</th>
      <th>leadType_instant-offer</th>
      <th>leadType_lead</th>
      <th>leadType_lionpay</th>
      <th>leadType_organic</th>
      <th>leadType_prescreen</th>
      <th>leadType_rc_returning</th>
      <th>leadType_repeat</th>
      <th>target</th>
      <th>time_to_originate</th>
      <th>time_since_last</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9299</th>
      <td>LL-I-00526002</td>
      <td>7996ea34884d235f656e25d9df4e8bc3</td>
      <td>1</td>
      <td>-inf</td>
      <td>0.0</td>
      <td>0.152605</td>
      <td>0.049475</td>
      <td>1.19243</td>
      <td>-0.14293</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>2.633038</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>10086</th>
      <td>LL-I-00260783</td>
      <td>7edc6acb596c64104d96b3d6897d2aed</td>
      <td>1</td>
      <td>6.380123</td>
      <td>0.0</td>
      <td>0.087203</td>
      <td>0.104839</td>
      <td>0.00000</td>
      <td>-0.14293</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>1.151735</td>
      <td>-inf</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-acdfb22a-444f-44ba-926d-3574fd10cb17')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-acdfb22a-444f-44ba-926d-3574fd10cb17 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-acdfb22a-444f-44ba-926d-3574fd10cb17');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-a402fda6-a026-4a6f-b73f-a99c2e7490c6">
  <button class="colab-df-quickchart" onclick="quickchart('df-a402fda6-a026-4a6f-b73f-a99c2e7490c6')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-a402fda6-a026-4a6f-b73f-a99c2e7490c6 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="160" id="mSLKLqDykb1A">
<div class="sourceCode" id="cb78"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(index<span class="op">=</span>[<span class="dv">9299</span>, <span class="dv">10086</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell markdown" id="qy7TDa6ckb1A">
<p>Finally, we perform a sanity check on the normalized features to make
sure nothing went wrong.</p>
</div>
<div class="cell code" data-execution_count="161"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="023j3JcVuQFq" data-outputId="e661de99-564d-44f1-e86c-e4418352d01f">
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>pprint(df.columns)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Index([&#39;loanId&#39;, &#39;anon_ssn&#39;, &#39;payFrequency&#39;, &#39;apr&#39;, &#39;nPaidOff&#39;, &#39;loanAmount&#39;,
       &#39;originallyScheduledPaymentAmount&#39;, &#39;leadCost&#39;, &#39;clearfraudscore&#39;,
       &#39;leadType_bvMandatory&#39;, &#39;leadType_california&#39;, &#39;leadType_express&#39;,
       &#39;leadType_instant-offer&#39;, &#39;leadType_lead&#39;, &#39;leadType_lionpay&#39;,
       &#39;leadType_organic&#39;, &#39;leadType_prescreen&#39;, &#39;leadType_rc_returning&#39;,
       &#39;leadType_repeat&#39;, &#39;target&#39;, &#39;time_to_originate&#39;, &#39;time_since_last&#39;],
      dtype=&#39;object&#39;)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="162"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:320}"
id="lZE4i8Sakb1A" data-outputId="3435b17e-a956-4e13-db37-f002cb3dce19">
<div class="sourceCode" id="cb81"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [<span class="st">&#39;loanAmount&#39;</span>, <span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>, <span class="st">&#39;apr&#39;</span>, <span class="st">&#39;time_since_last&#39;</span>, <span class="st">&#39;clearfraudscore&#39;</span>, <span class="st">&#39;nPaidOff&#39;</span>, <span class="st">&#39;leadCost&#39;</span>, <span class="st">&#39;time_to_originate&#39;</span>]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>df[features].describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="162">

  <div id="df-6d182cee-1189-42ff-b6ae-c0d29ab69f5b" class="colab-df-container">
    <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>loanAmount</th>
      <th>originallyScheduledPaymentAmount</th>
      <th>apr</th>
      <th>time_since_last</th>
      <th>clearfraudscore</th>
      <th>nPaidOff</th>
      <th>leadCost</th>
      <th>time_to_originate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>12459.000000</td>
      <td>12459.000000</td>
      <td>12459.000000</td>
      <td>12459.000000</td>
      <td>12459.000000</td>
      <td>12459.000000</td>
      <td>12459.000000</td>
      <td>12459.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.115390</td>
      <td>0.119188</td>
      <td>6.199059</td>
      <td>0.030695</td>
      <td>0.000023</td>
      <td>0.108273</td>
      <td>1.112824</td>
      <td>1.395926</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.098494</td>
      <td>0.097309</td>
      <td>0.279674</td>
      <td>2.235745</td>
      <td>1.000079</td>
      <td>0.162160</td>
      <td>0.975076</td>
      <td>0.905248</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.400864</td>
      <td>-1.000000</td>
      <td>-4.591849</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.054502</td>
      <td>0.061632</td>
      <td>5.966147</td>
      <td>-1.000000</td>
      <td>-0.470564</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.524981</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.087203</td>
      <td>0.090215</td>
      <td>6.336826</td>
      <td>-1.000000</td>
      <td>-0.142930</td>
      <td>0.000000</td>
      <td>1.192430</td>
      <td>1.340252</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.130804</td>
      <td>0.141995</td>
      <td>6.380123</td>
      <td>-1.000000</td>
      <td>0.727886</td>
      <td>0.328587</td>
      <td>1.857130</td>
      <td>2.353771</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>6.559034</td>
      <td>6.411629</td>
      <td>2.167749</td>
      <td>0.398473</td>
      <td>3.109518</td>
      <td>2.747909</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-6d182cee-1189-42ff-b6ae-c0d29ab69f5b')"
            title="Convert this dataframe to an interactive table."
            style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"/>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-6d182cee-1189-42ff-b6ae-c0d29ab69f5b button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-6d182cee-1189-42ff-b6ae-c0d29ab69f5b');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-eea5d1f1-4a13-4d3a-ae0f-dedfb4e33a66">
  <button class="colab-df-quickchart" onclick="quickchart('df-eea5d1f1-4a13-4d3a-ae0f-dedfb4e33a66')"
            title="Suggest charts"
            style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-eea5d1f1-4a13-4d3a-ae0f-dedfb4e33a66 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>

</div>
</div>
<div class="cell code" data-execution_count="163"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="FdvkTHi4kb1A" data-outputId="fab3995c-533c-413b-e447-aa219fbe529f">
<div class="sourceCode" id="cb82"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>df_pivot <span class="op">=</span> df[features].melt(var_name<span class="op">=</span><span class="st">&#39;variable&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;value&#39;</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(df_pivot, col<span class="op">=</span><span class="st">&#39;variable&#39;</span>, col_wrap<span class="op">=</span><span class="dv">4</span>, height<span class="op">=</span><span class="dv">4</span>, sharex<span class="op">=</span><span class="va">False</span>, sharey<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> g.<span class="bu">map</span>(sns.histplot, <span class="st">&#39;value&#39;</span>, bins<span class="op">=</span><span class="st">&#39;auto&#39;</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>g.set_titles(<span class="st">&#39;</span><span class="sc">{col_name}</span><span class="st">&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">&#39;&#39;</span>, ylabel<span class="op">=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax <span class="kw">in</span> g.axes.flat:</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    plt.setp(ax.get_xticklabels(), fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    plt.setp(ax.get_yticklabels(), fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">&#39;Normallized Feature Distributions&#39;</span>, fontsize<span class="op">=</span><span class="dv">20</span>, y<span class="op">=</span><span class="fl">1.05</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>g.tight_layout()</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;/content/drive/MyDrive/loan-default-model/normalized_feature_distributions.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/0f16025c0ad7cf0703ee3fc5fee6a6c9e5e2de79.png" /></p>
</div>
</div>
<div class="cell markdown" id="fGGGx_rekb1B">
<p>Notice:</p>
<ul>
<li>features with min-max scaling (<code>loanAmount</code>,
<code>originallyScheduledPaymentAmount</code>) are now nicely
distributed over the interval [0, 1].</li>
<li>features with z-score standardization (<code>clearfraudscore</code>)
remain Gaussian with a mean close to 0 and standard deviation near
1.</li>
<li>features with box-cox transformation (<code>nPaidOff</code>,
<code>time_to_originate</code>, <code>leadCost</code>) have improved
Gaussianity (more symmetrical distributions) with reduced skewness.</li>
<li>features with logarithmic transform (<code>apr</code>; we'll address
<code>time_since_last</code> shortly) appear more Gaussian-like with
less skewness than before.</li>
</ul>
<p>All in all, no significant deviations in the features' distributions
w.r.t. our expectations! Only thing of note is the histogram of
<code>time_since_last</code>, as since we only normalized the positive
values, it'd be more useful to visualize the distribution of these data
instead.</p>
</div>
<div class="cell markdown" id="K2g04frbkb1B">
<p>Indeed, the data appear much better than before!</p>
</div>
<div class="cell code" data-execution_count="164"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:601}"
id="vmetUyHXecBP" data-outputId="c18abc5a-5e1f-46db-8eef-5d9347f7bdcf">
<div class="sourceCode" id="cb83"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Time Since Last Application</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">&quot;whitegrid&quot;</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the plot</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[df[<span class="st">&#39;time_since_last&#39;</span>] <span class="op">&gt;=</span> <span class="dv">0</span>][<span class="st">&#39;time_since_last&#39;</span>], bins<span class="op">=</span><span class="dv">40</span>, color<span class="op">=</span><span class="st">&#39;skyblue&#39;</span>, kde<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">&#39;slategray&#39;</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Customize the plot</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Time Since Last (&gt;= 0)&#39;</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Time Since Last&#39;</span>, fontsize<span class="op">=</span><span class="dv">14</span>)  <span class="co"># Adding an X label for clarity</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Removed plt.ylabel(&#39;&#39;) as it&#39;s redundant when not specifying a label</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional aesthetics</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>sns.despine()  <span class="co"># Remove the top and right spines</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">&#39;major&#39;</span>, axis<span class="op">=</span><span class="st">&#39;y&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;--&#39;</span>, linewidth<span class="op">=</span><span class="fl">0.75</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Enhance grid lines for y-axis</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout to make sure everything fits well without being cut off</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure. Adjust the save path as per your environment</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;./normalized_feature_distributions_correction.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plot</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/14895d6be8381cb0d109077f0b90dd045a737917.png" /></p>
</div>
</div>
<div class="cell markdown" id="r1Xot_84fCb_">
<p><strong>Positive Skewness</strong>: The distribution of
<code>time_since_last</code> for returning clients is positively skewed,
indicating that most clients reapply for loans within a relatively short
time frame after their last loan.</p>
</div>
<div class="cell code" data-execution_count="165"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="1gFTiPeMYTfw" data-outputId="608aeda5-b667-49aa-91f3-4730595a1e29">
<div class="sourceCode" id="cb84"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Class Imbalance</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> df.drop([<span class="st">&#39;loanId&#39;</span>, <span class="st">&#39;anon_ssn&#39;</span>, <span class="st">&#39;target&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>), df[<span class="st">&#39;target&#39;</span>]</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the class distribution before balancing (same as before)</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Class distribution before balancing: </span><span class="ch">\n</span><span class="sc">{</span>y<span class="sc">.</span>value_counts(normalize<span class="op">=</span><span class="va">True</span>)<span class="sc">.</span><span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f&quot;</span><span class="sc">{</span>x <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%&quot;</span>)<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;</span>)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Balance the class distribution using SMOTE</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>smote <span class="op">=</span> SMOTE(random_state<span class="op">=</span><span class="dv">42</span>)  <span class="co"># You might adjust parameters here</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>X_resampled, y_resampled <span class="op">=</span> smote.fit_resample(X, y)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the class distribution after balancing (same as before)</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&#39;Class distribution after balancing: </span><span class="ch">\n</span><span class="sc">{</span>y_resampled<span class="sc">.</span>value_counts(normalize<span class="op">=</span><span class="va">True</span>)<span class="sc">.</span><span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f&quot;</span><span class="sc">{</span>x <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%&quot;</span>)<span class="sc">}</span><span class="ch">\n</span><span class="ss">&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Class distribution before balancing: 
1.0    97.38%
0.0     2.62%
Name: target, dtype: object

Class distribution after balancing: 
1.0    50.00%
0.0    50.00%
Name: target, dtype: object

</code></pre>
</div>
</div>
<div class="cell markdown" id="73w-j97b5Rh6">
<p>SMOTE (Synthetic Minority Oversampling Technique) is a technique used
to tackle imbalance data by oversampling the minority class. It works by
generating synthetic data points for the minority class, which helps to
balance the dataset and improve the performance of machine learning
models.</p>
<p>Here are some reasons why SMOTE is a popular choice for tackling
imbalance data:</p>
<ul>
<li><p><strong>Simplicity:</strong> SMOTE is a relatively simple and
straightforward technique to implement. It does not require any complex
tuning of parameters or the use of specialized algorithms.</p></li>
<li><p><strong>Effectiveness:</strong> SMOTE has been shown to be
effective in improving the performance of machine learning models on
imbalanced datasets. It can help to reduce bias towards the majority
class and improve the model's ability to detect and classify minority
class instances.</p></li>
<li><p><strong>Computational efficiency:</strong> SMOTE is a
computationally efficient technique. It does not require a significant
amount of time or resources to generate synthetic data points.</p></li>
<li><p><strong>Flexibility:</strong> SMOTE can be used with a variety of
machine learning algorithms and can be easily integrated into existing
pipelines.</p></li>
</ul>
<p>Overall, SMOTE is a versatile and effective technique for tackling
imbalance data that can improve the performance of machine learning
models.</p>
</div>
<section id="train-test-split" class="cell markdown" id="xJkYTLlmkb1B">
<h2>Train-Test Split</h2>
</section>
<div class="cell code" data-execution_count="166" id="1N4BSFBukb1B">
<div class="sourceCode" id="cb86"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_resampled, y_resampled, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code></pre></div>
</div>
<div class="cell markdown" id="Uv0zsZw9kb1B">
<p>#Model Development</p>
<p>Moving onto the model development phase, we'll experiment with a
couple different models, and fine-tune the best performing one. Note
that our models should be robust to skewness, based on our findings in
previous sections. Also, due to the class imbalance, we'll evaluate each
model's performance using ROC-AUC score, rather than accuracy.</p>
</div>
<section id="training" class="cell markdown" id="_q6aSz0Ckb1B">
<h2>Training</h2>
<p>We proceed with the following popular binary classification
models:</p>
<ul>
<li>Logistic regression</li>
<li>Support Vector Machine</li>
<li>Random Forest Ensemble</li>
<li>Multi-Layer Perceptron (Neural Net)</li>
<li>Cat Boost</li>
<li>Xg Boost</li>
<li>Gradient Boost</li>
<li>Stacking</li>
<li>Ada Boost</li>
</ul>
<p>More specifically, we train each model on the data in
<code>X_train</code> &amp; <code>y_train</code>, and evaluate each
model's performance on <code>X_test</code> &amp; <code>y_test</code>
using their ROC-AUC score (expressed as a percentage).</p>
</section>
<div class="cell code" data-execution_count="167"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:866}"
id="ltGFlPMfvL_Y" data-outputId="c8a4ffa4-73c6-4a65-a2b2-f541045f9460">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Model Comparison</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base estimators for stacking</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>estimators <span class="op">=</span> [</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;rf&#39;</span>, RandomForestClassifier(n_jobs<span class="op">=-</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">42</span>)),</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">&#39;xgb&#39;</span>, XGBClassifier(use_label_encoder<span class="op">=</span><span class="va">False</span>, eval_metric<span class="op">=</span><span class="st">&#39;logloss&#39;</span>, random_state<span class="op">=</span><span class="dv">42</span>))</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize models including the StackingClassifier</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Logistic Regression&#39;</span>: LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;SVM&#39;</span>: SVC(probability<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Random Forest&#39;</span>: RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Neural Network&#39;</span>: MLPClassifier(max_iter<span class="op">=</span><span class="dv">1000</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;XGBoost&#39;</span>: XGBClassifier(use_label_encoder<span class="op">=</span><span class="va">False</span>, eval_metric<span class="op">=</span><span class="st">&#39;logloss&#39;</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;LightGBM&#39;</span>: LGBMClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;CatBoost&#39;</span>: CatBoostClassifier(verbose<span class="op">=</span><span class="dv">0</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;AdaBoost&#39;</span>: AdaBoostClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Gradient Boosting&#39;</span>: GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Stacking&#39;</span>: StackingClassifier(estimators<span class="op">=</span>estimators, final_estimator<span class="op">=</span>LogisticRegression(), n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models and plot ROC curves</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model3 <span class="kw">in</span> models.items():</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>    model3.fit(X_train, y_train)</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>    fpr3, tpr3, thresholds <span class="op">=</span> roc_curve(y_test, model3.predict_proba(X_test)[:, <span class="dv">1</span>])</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>    plt.plot(fpr3, tpr3, label<span class="op">=</span><span class="ss">f&#39;</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> (AUC = </span><span class="sc">{</span>roc_auc_score(y_test, model3.predict_proba(X_test)[:, <span class="dv">1</span>]) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)&#39;</span>)</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">&#39;k--&#39;</span>)</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.0</span>, <span class="fl">1.05</span>])</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;False Positive Rate&#39;</span>)</span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;True Positive Rate&#39;</span>)</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Receiver Operating Characteristic (ROC) Curves&#39;</span>)</span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&quot;lower right&quot;</span>)</span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;/content/drive/MyDrive/loan-default-model/roc_auc.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[LightGBM] [Info] Number of positive: 9711, number of negative: 9701
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000745 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 2052
[LightGBM] [Info] Number of data points in the train set: 19412, number of used features: 15
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.500258 -&gt; initscore=0.001030
[LightGBM] [Info] Start training from score 0.001030
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/b1d2fa8ccf6c306e6531941b611216d11581241c.png" /></p>
</div>
</div>
<div class="cell markdown" id="BwaUg_0Q8owH">
<p><strong>Analyze the ROC-AUC plot and provide insights:</strong></p>
<ul>
<li><strong>1. Overall Performance:</strong>
<ul>
<li>All models perform reasonably well, with AUC scores above 0.7.<br />
</li>
<li>However, there is a noticeable gap between the best-performing
models and the worst-performing models.</li>
</ul></li>
<li><strong>2. Best-Performing Models:</strong>
<ul>
<li>Stacking, XGBoost, and LightGBM achieve the highest AUC scores,
indicating their superior performance in predicting loan defaults.</li>
<li>These models are able to distinguish between positive and negative
loan applications with high accuracy.</li>
</ul></li>
<li><strong>3. Worst-Performing Models:</strong>
<ul>
<li>Logistic Regression and SVM have the lowest AUC scores, suggesting
that they may not be as effective in capturing the complexities of loan
default prediction.</li>
</ul></li>
<li><strong>4. Model Comparison:</strong>
<ul>
<li>Random Forest, Neural Network, AdaBoost, and Gradient Boosting
perform similarly, with AUC scores in the middle range.</li>
<li>This suggests that these models offer a balance between performance
and computational efficiency.</li>
</ul></li>
<li><strong>5. Stacking Ensemble:</strong>
<ul>
<li>The StackingClassifier, which combines the predictions of multiple
models, achieves the highest AUC score.</li>
<li>This indicates that ensemble methods can leverage the strengths of
individual models to improve overall performance.</li>
</ul></li>
<li><strong>6. Threshold Selection:</strong>
<ul>
<li>The optimal threshold for classifying loan applications can be
determined based on the desired balance between false positives and
false negatives.</li>
<li>A higher threshold will reduce false positives but increase false
negatives, and vice versa.</li>
</ul></li>
<li><strong>7. Practical Considerations:</strong>
<ul>
<li>When selecting a model for deployment, factors such as computational
cost, interpretability, and scalability should also be considered.</li>
<li>For example, while Stacking achieves the highest accuracy, it may be
more computationally expensive than other models.</li>
</ul></li>
</ul>
</div>
<section id="42-model-selection" class="cell markdown"
id="IwJvtMbbkb1B">
<h1>4.2 Model Selection</h1>
<p>models like Random Forest and a Stacking Classifier that includes
Random Forest and XGBoost as base estimators outperform other models in
a loan default prediction task, several factors could contribute to
this:</p>
<p>#Random Forest Strengths: <strong>1.Handling Non-linearity:</strong>
Random Forest can capture complex, non-linear relationships in the data,
which might be present in the predictors of loan default.</p>
<p><strong>2.Feature Interaction:</strong> It naturally considers
interactions between features without any explicit feature engineering
required.</p>
<p><strong>3.Robustness to Overfitting:</strong> Due to the ensemble
nature of averaging multiple decision trees, Random Forests are less
prone to overfitting compared to single decision trees.</p>
<p><strong>4.Handling Missing Values:</strong> Random Forest can handle
missing values in the data to some extent.</p>
<p><strong>5.Variable Importance:</strong> It can differentiate between
more and less informative features and give higher weight to the more
informative ones.</p>
<p>#Stacking Classifier Strengths: <strong>1.Leveraging Strengths of
Individual Models:</strong> The Stacking Classifier leverages the
strengths of both Random Forest and XGBoost, combining their diverse
perspectives on the data.</p>
<p><strong>2.Error Correction:</strong> It allows one model to correct
the errors of the other, potentially leading to better
generalization.</p>
<p><strong>3.Meta-Learning:</strong> The meta-learner (the final
estimator in stacking, which is Logistic Regression in your case) learns
the best way to combine the predictions of the base models, which can
lead to a model that outperforms any single base estimator.</p>
<p>#Loan Default Prediction Specifics: <strong>1.Data
Complexity:</strong> The loan default prediction problem may have
complex patterns and interactions between features that are better
captured by tree-based models.</p>
<p><strong>2.Feature Types:</strong> If the dataset contains a mix of
numerical and categorical variables, tree-based models and ensembles can
handle this variety effectively without the need for extensive
preprocessing.</p>
<p><strong>3.Predictive Signals:</strong> Random Forest and ensemble
methods may be better at picking up the weaker signals that are
indicative of default but might be missed by other models.</p>
<p>#Why Ensemble Models Might Outperform: <strong>1.Diverse
Predictions:</strong> Ensemble methods can benefit from the diversity of
predictions made by the base estimators, reducing the variance and
possibly bias of the final prediction.</p>
<p><strong>2.Better Generalization:</strong> They tend to generalize
better by combining the predictions of multiple models, thus performing
well on unseen data.</p>
<p><strong>In our specific case, the Random Forest and the Stacking
Classifier with Random Forest and XGBoost likely offer a good balance
between bias and variance, capture complex patterns well, and make more
accurate predictions for the problem of loan default. This is why you
are seeing a higher AUC for these models on the ROC curve.</strong></p>
</section>
<section id="44-model-evaluation" class="cell markdown"
id="SSvK59Qckb1B">
<h2>4.4 Model Evaluation</h2>
<p>It remains to evaluate the model to gain a deeper understanding of
what's happening "under the hood". We can do so by visualizing the
feature importances of the trees in the forest, to see which features
are most/least important for the model to arrive at the right
answer.</p>
</section>
<div class="cell code" data-execution_count="168"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:817}"
id="KfW_Ca0DntnU" data-outputId="a69954ba-68b4-494f-817e-e3fe08029d62">
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Feature Importances</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> models[<span class="st">&#39;Random Forest&#39;</span>]</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> clf.feature_importances_</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the standard deviation of feature importances across the trees in the random forest</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>std <span class="op">=</span> np.std([tree.feature_importances_ <span class="cf">for</span> tree <span class="kw">in</span> clf.estimators_], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> np.argsort(importances)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame for plotting</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>feature_importances <span class="op">=</span> pd.DataFrame({</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Features&#39;</span>: X.columns[indices],</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Importance&#39;</span>: importances[indices],</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Standard Deviation&#39;</span>: std[indices]</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a horizontal bar chart with Plotly Express</span></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(feature_importances, y<span class="op">=</span><span class="st">&#39;Features&#39;</span>, x<span class="op">=</span><span class="st">&#39;Importance&#39;</span>, error_x<span class="op">=</span><span class="st">&#39;Standard Deviation&#39;</span>,</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>             orientation<span class="op">=</span><span class="st">&#39;h&#39;</span>, title<span class="op">=</span><span class="st">&#39;Feature Importances&#39;</span>, height<span class="op">=</span><span class="dv">800</span>)</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Update layout for aesthetics</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>    yaxis<span class="op">=</span>{<span class="st">&#39;categoryorder&#39;</span>:<span class="st">&#39;total ascending&#39;</span>},</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">&#39;Feature Importance&#39;</span>,</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">&#39;Features&#39;</span>,</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    template<span class="op">=</span><span class="st">&#39;plotly_white&#39;</span>,  <span class="co"># Clean white background</span></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>    title_font_size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>    xaxis_tickformat<span class="op">=</span><span class="st">&#39;%&#39;</span>,  <span class="co"># Format x-axis tick labels as percentages</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>    xaxis_tickfont_size<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>    yaxis_tickfont_size<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>    legend_title_font_size<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>    legend_font_size<span class="op">=</span><span class="dv">12</span></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Update traces for better readability and aesthetics</span></span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a>fig.update_traces(marker_color<span class="op">=</span><span class="st">&#39;lightseagreen&#39;</span>,  <span class="co"># Set the color of the bars</span></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a>                  marker_line_color<span class="op">=</span><span class="st">&#39;darkslategrey&#39;</span>,  <span class="co"># Set the color of the bar borders</span></span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a>                  marker_line_width<span class="op">=</span><span class="fl">1.5</span>,  <span class="co"># Set the width of the bar borders</span></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a>                  texttemplate<span class="op">=</span><span class="st">&#39;%</span><span class="sc">{x:.2%}</span><span class="st">&#39;</span>,  <span class="co"># Set the text template for the bars</span></span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a>                  textposition<span class="op">=</span><span class="st">&#39;inside&#39;</span>  <span class="co"># Position the text inside the bars</span></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<div class="output display_data">
<html>
<head><meta charset="utf-8" /></head>
<body>
    <div>            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script charset="utf-8" src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>                <div id="a1f7daed-c353-4d75-8efa-369606e9920c" class="plotly-graph-div" style="height:800px; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("a1f7daed-c353-4d75-8efa-369606e9920c")) {                    Plotly.newPlot(                        "a1f7daed-c353-4d75-8efa-369606e9920c",                        [{"alignmentgroup":"True","error_x":{"array":[0.03412287389396564,0.029422487547337974,0.012623060235263757,0.012105007464403454,0.013856985708055944,0.021160661527385074,0.024534932333375767,0.005387644993497928,0.005536437374660592,0.005334214768241871,0.008222104429790737,0.003769699683186627,0.003117114322670111,0.0014905292923342518,0.0007139573376618397,0.00031520873178865873,0.0001563892561719885,0.00012416916755926717,6.193572131486137e-06]},"hovertemplate":"Importance=%{x}\u003cbr\u003eFeatures=%{y}\u003cextra\u003e\u003c\u002fextra\u003e","legendgroup":"","marker":{"color":"lightseagreen","pattern":{"shape":""},"line":{"color":"darkslategrey","width":1.5}},"name":"","offsetgroup":"","orientation":"h","showlegend":false,"textposition":"inside","x":[0.1827012229667648,0.18139919608039998,0.12395868210502953,0.12259763649823952,0.10934112377893804,0.09766668767782252,0.08138920063187056,0.03878336820104137,0.025829395733236414,0.010638566977486455,0.007922583022399473,0.0077875072286220474,0.006276275154120147,0.0027997719745366596,0.0005366877414648385,0.00021330402566707848,8.722138974184506e-05,7.059707943627787e-05,9.717331823034636e-07],"xaxis":"x","y":["loanAmount","apr","clearfraudscore","time_to_originate","originallyScheduledPaymentAmount","leadCost","nPaidOff","payFrequency","time_since_last","leadType_organic","leadType_rc_returning","leadType_bvMandatory","leadType_lead","leadType_prescreen","leadType_california","leadType_lionpay","leadType_repeat","leadType_express","leadType_instant-offer"],"yaxis":"y","type":"bar","texttemplate":"%{x:.2%}"}],                        {"template":{"data":{"barpolar":[{"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"white","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"#C8D4E3","linecolor":"#C8D4E3","minorgridcolor":"#C8D4E3","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"white","showlakes":true,"showland":true,"subunitcolor":"#C8D4E3"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"white","polar":{"angularaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""},"bgcolor":"white","radialaxis":{"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"yaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"},"zaxis":{"backgroundcolor":"white","gridcolor":"#DFE8F3","gridwidth":2,"linecolor":"#EBF0F8","showbackground":true,"ticks":"","zerolinecolor":"#EBF0F8"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"baxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""},"bgcolor":"white","caxis":{"gridcolor":"#DFE8F3","linecolor":"#A2B1C6","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"#EBF0F8","linecolor":"#EBF0F8","ticks":"","title":{"standoff":15},"zerolinecolor":"#EBF0F8","zerolinewidth":2}}},"xaxis":{"anchor":"y","domain":[0.0,1.0],"title":{"text":"Feature Importance"},"tickfont":{"size":12},"tickformat":"%"},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"Features"},"tickfont":{"size":12},"categoryorder":"total ascending"},"legend":{"tracegroupgap":0,"title":{"font":{"size":14}},"font":{"size":12}},"title":{"text":"Feature Importances","font":{"size":20}},"barmode":"relative","height":800},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('a1f7daed-c353-4d75-8efa-369606e9920c');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                            </script>        </div>
</body>
</html>
</div>
</div>
<div class="cell markdown" id="Dk697rfcd3k6">
<p>The feature importance plot reveals the relative importance of each
feature in the Random Forest model's predictions. Here are some key
insights:</p>
<p><strong>1. Dominant Features:</strong></p>
<ul>
<li><code>leadCost</code>, <code>nPaidOff</code>, and
<code>time_to_originate</code> are the most influential features,
indicating their strong association with loan default.</li>
</ul>
<p><strong>2. Moderate Importance:</strong></p>
<ul>
<li><code>loanAmount</code>, <code>time_since_last</code>,
<code>clearfraudscore</code>, and
<code>originallyScheduledPaymentAmount</code> also play a significant
role, albeit to a lesser extent.</li>
</ul>
<p><strong>3. Less Important Features:</strong></p>
<ul>
<li><code>apr</code> appears to have a relatively lower importance,
suggesting that it may not be as strongly indicative of loan default in
this context.</li>
</ul>
<p><strong>4. Interpretation:</strong></p>
<ul>
<li>High <code>leadCost</code> could indicate that loans acquired
through expensive marketing channels are more likely to default.</li>
<li>A higher number of <code>nPaidOff</code> loans may reflect a
borrower's financial stability and reduce the likelihood of
default.</li>
<li>Longer <code>time_to_originate</code> could imply a more thorough
loan application process, potentially reducing default risk.</li>
</ul>
<p><strong>5. Actionable Insights:</strong></p>
<ul>
<li>Lenders may consider optimizing their marketing strategies to reduce
<code>leadCost</code> without compromising lead quality.</li>
<li>Encouraging borrowers to make regular payments and maintain a good
credit history (reflected in <code>nPaidOff</code>) can help mitigate
default risk.</li>
<li>Streamlining the loan origination process to reduce
<code>time_to_originate</code> could potentially improve loan
performance.</li>
</ul>
<p>Overall, the feature importance analysis provides valuable insights
into the factors that influence loan default, enabling lenders to make
informed decisions and develop targeted strategies to minimize risk.</p>
</div>
<div class="cell code" data-execution_count="169"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="4M_ogYFjTEUA" data-outputId="070eb64a-a8b1-4511-cf7c-3e6acb34dad4">
<div class="sourceCode" id="cb90"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>pprint(feature_importances[<span class="st">&#39;Features&#39;</span>].to_list())</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[&#39;loanAmount&#39;,
 &#39;apr&#39;,
 &#39;clearfraudscore&#39;,
 &#39;time_to_originate&#39;,
 &#39;originallyScheduledPaymentAmount&#39;,
 &#39;leadCost&#39;,
 &#39;nPaidOff&#39;,
 &#39;payFrequency&#39;,
 &#39;time_since_last&#39;,
 &#39;leadType_organic&#39;,
 &#39;leadType_rc_returning&#39;,
 &#39;leadType_bvMandatory&#39;,
 &#39;leadType_lead&#39;,
 &#39;leadType_prescreen&#39;,
 &#39;leadType_california&#39;,
 &#39;leadType_lionpay&#39;,
 &#39;leadType_repeat&#39;,
 &#39;leadType_express&#39;,
 &#39;leadType_instant-offer&#39;]
</code></pre>
</div>
</div>
<div class="cell markdown" id="XYJ42ZkZkb1B">
<p>Interestingly, the various lead types don't seem to be of much
importance to our model, while features that describe the financial
obligations of the loan (like <code>loanAmount</code>, <code>apr</code>,
and <code>originallyScheduledPaymentAmount</code>) play a bigger part in
its decision making process; indeed, this is to be expected.</p>
<p>We also notice that <code>clearfraudscore</code> and
<code>time_to_originate</code> play significant roles from the
perspective of the model. The former is reasonable enough, since we were
told that the column represents the underwriting team's predicted
probability that the loan will default.</p>
</div>
<div class="cell code" data-execution_count="170"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:727}"
id="WpRSJnVqQQN5" data-outputId="596c2608-7ab4-4cd2-c979-bea0d59edc8e">
<div class="sourceCode" id="cb92"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Model Comparison</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define base estimators for stacking</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize models including the StackingClassifier</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Random Forest&#39;</span>: RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models and plot ROC curves</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model3 <span class="kw">in</span> models.items():</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>    model3.fit(X_train, y_train)</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>    fpr3, tpr3, thresholds <span class="op">=</span> roc_curve(y_test, model3.predict_proba(X_test)[:, <span class="dv">1</span>])</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>    plt.plot(fpr3, tpr3, label<span class="op">=</span><span class="ss">f&#39;</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> (AUC = </span><span class="sc">{</span>roc_auc_score(y_test, model3.predict_proba(X_test)[:, <span class="dv">1</span>]) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)&#39;</span>)</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">&#39;k--&#39;</span>)</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.0</span>, <span class="fl">1.05</span>])</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;False Positive Rate&#39;</span>)</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;True Positive Rate&#39;</span>)</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Receiver Operating Characteristic (ROC) Curves&#39;</span>)</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&quot;lower right&quot;</span>)</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;/content/drive/MyDrive/loan-default-model/roc_auc.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/99b99187d12da1e1137c4ad37248ed73fdefb39c.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="171"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:727}"
id="9D0-PTaoT-Vw" data-outputId="03cdbf30-aa8e-4266-ac1b-eab856628a93">
<div class="sourceCode" id="cb93"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>desired_features <span class="op">=</span> [<span class="st">&#39;loanAmount&#39;</span>,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;apr&#39;</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;clearfraudscore&#39;</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;time_to_originate&#39;</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;originallyScheduledPaymentAmount&#39;</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadCost&#39;</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;nPaidOff&#39;</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;payFrequency&#39;</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;time_since_last&#39;</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_organic&#39;</span>,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_rc_returning&#39;</span>,</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_bvMandatory&#39;</span>,</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_lead&#39;</span>,</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_prescreen&#39;</span>,</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_california&#39;</span>,</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_lionpay&#39;</span>,</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a> <span class="st">&#39;leadType_repeat&#39;</span>]</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the training and testing data to the desired features</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>X_train_top10 <span class="op">=</span> X_train[desired_features]</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>X_test_top10 <span class="op">=</span> X_test[desired_features]</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> {</span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;Random Forest&#39;</span>: RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models and plot ROC curves</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, model3 <span class="kw">in</span> models.items():</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>    model3.fit(X_train_top10, y_train)</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>    fpr3, tpr3, thresholds <span class="op">=</span> roc_curve(y_test, model3.predict_proba(X_test_top10)[:, <span class="dv">1</span>])</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>    plt.plot(fpr3, tpr3, label<span class="op">=</span><span class="ss">f&#39;</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> (AUC = </span><span class="sc">{</span>roc_auc_score(y_test, model3.predict_proba(X_test_top10)[:, <span class="dv">1</span>]) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%)&#39;</span>)</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">&#39;k--&#39;</span>)</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.0</span>, <span class="fl">1.05</span>])</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;False Positive Rate&#39;</span>)</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;True Positive Rate&#39;</span>)</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Receiver Operating Characteristic (ROC) Curves&#39;</span>)</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&quot;lower right&quot;</span>)</span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;/content/drive/MyDrive/loan-default-model/roc_auc.png&#39;</span>, <span class="bu">format</span><span class="op">=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/db85b5c4eb6cdda4e6b593576b71a6feccd99547.png" /></p>
</div>
</div>
<div class="cell markdown" id="9CmN2f32rczF">
<p>#Reducing the number of features in a model without significantly
reducing the AUC-ROC can be beneficial for several reasons:</p>
<p><strong>Simplicity</strong>: A simpler model with fewer features is
generally preferable because it's easier to understand, explain, and
maintain. If you can achieve similar performance with fewer variables,
the model is more elegant and may be considered more robust.</p>
<p><strong>Performance:</strong> Fewer features can lead to faster
training and prediction times, which is important for models that will
be retrained frequently or need to make predictions in real-time.</p>
<p><strong>Overfitting:</strong> A model with a large number of
features, especially relative to the number of observations, is at risk
of overfitting. Overfitting occurs when a model learns the noise in the
training data rather than the actual signal. A model with fewer features
may generalize better to new, unseen data.</p>
<p><strong>Interpretability:</strong> Models with fewer features are
often more interpretable because the contribution of each feature to the
model's predictions is clearer. This is especially important in fields
like finance or medicine, where understanding why a model makes a
certain prediction is as important as the prediction's accuracy.</p>
<p><strong>Costs:</strong> In many real-world applications, collecting
data can be expensive and time-consuming. If a model can maintain high
accuracy with fewer features, it may reduce the costs associated with
data collection.</p>
<p><strong>Stability:</strong> Fewer features can lead to more stability
in the model predictions. High-dimensional spaces are prone to the curse
of dimensionality, where adding more features can lead to an exponential
increase in the required data to maintain model performance.</p>
<p><strong>Feature Importance and Selection:</strong> Identifying a
smaller subset of important features can provide valuable insights into
the underlying processes that generated the data. For example, in loan
default prediction, understanding which factors are most predictive of
default can inform credit policies.</p>
<p>In summary, if you can reduce the complexity of the model without a
significant drop in AUC-ROC, you can achieve a more efficient,
interpretable, and potentially more accurate model when applied outside
of your training dataset.</p>
</div>
<div class="cell code" data-execution_count="172"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:851}"
id="nRI7v-mgrbpZ" data-outputId="af792ab1-3623-4d7e-8783-ef35f066f1d3">
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># @title Confusion Matrix</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming model_rf is your trained Random Forest model</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> models[<span class="st">&#39;Random Forest&#39;</span>].predict(X_test_top10)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print precision, recall, f1-score and support</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Classification Report:&quot;</span>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred))</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print accuracy</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Accuracy:&quot;</span>, accuracy_score(y_test, y_pred))</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and visualize confusion matrix</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">&quot;d&quot;</span>, cmap<span class="op">=</span><span class="st">&quot;Blues&quot;</span>, xticklabels<span class="op">=</span>[<span class="st">&#39;Predicted Negative&#39;</span>, <span class="st">&#39;Predicted Positive&#39;</span>], yticklabels<span class="op">=</span>[<span class="st">&#39;Actual Negative&#39;</span>, <span class="st">&#39;Actual Positive&#39;</span>])</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Actual Label&#39;</span>)</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Predicted Label&#39;</span>)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Confusion Matrix&#39;</span>)</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and print specific metrics if needed</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>tn, fp, fn, tp <span class="op">=</span> cm.ravel()</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>precision <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fp)</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>recall <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn)</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>f1_score <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (precision <span class="op">*</span> recall) <span class="op">/</span> (precision <span class="op">+</span> recall)</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Precision: </span><span class="sc">{</span>precision<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Recall: </span><span class="sc">{</span>recall<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;F1 Score: </span><span class="sc">{</span>f1_score<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, calculate True Positive Rate (TPR) and False Positive Rate (FPR)</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>tpr <span class="op">=</span> tp <span class="op">/</span> (tp <span class="op">+</span> fn)</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>fpr <span class="op">=</span> fp <span class="op">/</span> (fp <span class="op">+</span> tn)</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;True Positive Rate (TPR): </span><span class="sc">{</span>tpr<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;False Positive Rate (FPR): </span><span class="sc">{</span>fpr<span class="sc">:.4f}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Classification Report:
              precision    recall  f1-score   support

         0.0       0.98      0.98      0.98      2432
         1.0       0.98      0.98      0.98      2422

    accuracy                           0.98      4854
   macro avg       0.98      0.98      0.98      4854
weighted avg       0.98      0.98      0.98      4854

Accuracy: 0.9796044499381953
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_2926ee316790466ca266a6af5bf2939e/0167f63e4989961006aac82b02c33b961db012ad.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Precision: 0.9778
Recall: 0.9814
F1 Score: 0.9796
True Positive Rate (TPR): 0.9814
False Positive Rate (FPR): 0.0222
</code></pre>
</div>
</div>
<div class="cell markdown" id="Md3aX8X7ukYs">
<p><em>When evaluating a loan default prediction model, while AUC-ROC is
a strong primary metric due to its ability to assess performance across
different classification thresholds, it's also important to consider
additional secondary metrics that align with the business objectives and
the costs associated with the different types of errors. Here are some
commonly used secondary metrics and their justifications:</em></p>
<p><strong>Precision and Recall (F1 Score)</strong></p>
<p>Precision measures the accuracy of the positive predictions (i.e.,
what fraction of predicted defaults were actually defaults). This is
important if the cost of false positives (incorrectly predicting
default) is high, such as losing customers due to unnecessary credit
restrictions.</p>
<p>Recall measures the ability of the model to find all the positive
instances (i.e., what fraction of actual defaults were predicted as
such). This is crucial if the cost of false negatives (failing to
predict a default) is high, as missing out on detecting a default could
lead to financial losses.</p>
<p>F1 Score is the harmonic mean of precision and recall, providing a
single measure that balances the two. It is particularly useful when
there’s an uneven class distribution, as often occurs with loan defaults
where defaults are less common than non-defaults.</p>
<p><strong>Reasons for Secondary Metrics:</strong></p>
<p><strong>Business Alignment:</strong> Metrics should reflect the cost
and impact of different types of classification errors in the context of
the business.</p>
<p><strong>Decision Thresholds:</strong> Different metrics may be
optimal at different decision thresholds, and the business will need to
decide which threshold aligns best with its objectives.</p>
<p><strong>Model Interpretability:</strong> Some metrics can help in
interpreting the model’s performance in terms of business understanding,
like how many defaults are captured (recall) versus how many of those
flagged as defaults are actually defaults (precision).</p>
</div>
<div class="cell markdown" id="SZY6kyj-1sYC">
<p><strong>Highlights:</strong></p>
<ul>
<li><strong>Data Preprocessing:</strong>
<ul>
<li>Handled missing values using a combination of imputation and
dropping columns with high missingness.</li>
<li>Applied Box-Cox transformation to normalize skewed numerical
features.</li>
<li>Scaled numerical features using MinMaxScaler to ensure they are on a
similar scale.</li>
<li>Performed oversampling using SMOTE to address class imbalance.</li>
</ul></li>
<li><strong>Model Development:</strong>
<ul>
<li>Trained and evaluated several binary classification models,
including Logistic Regression, SVM, Random Forest, Neural Network,
XGBoost, LightGBM, CatBoost, AdaBoost, Gradient Boosting, and Stacking
Classifier.</li>
<li>Used ROC-AUC score as the primary metric for model evaluation due to
the class imbalance.</li>
</ul></li>
<li><strong>Model Selection:</strong>
<ul>
<li>Random Forest and Stacking Classifier with Random Forest and XGBoost
as base estimators outperformed other models, likely due to their
ability to capture complex patterns and handle non-linearity.</li>
</ul></li>
<li><strong>Model Evaluation:</strong>
<ul>
<li>Visualized feature importances to understand the key factors
influencing loan default predictions.</li>
<li>Demonstrated that reducing the number of features to the top 10 most
important ones did not significantly impact the AUC-ROC score, providing
a more efficient and interpretable model.</li>
</ul></li>
<li><strong>Secondary Metrics:</strong>
<ul>
<li>Emphasized the importance of considering secondary metrics like
precision, recall, and F1 score to assess model performance in the
context of business objectives and costs associated with different types
of errors.</li>
</ul></li>
<li><strong>Business Alignment:</strong>
<ul>
<li>Stressed the need to align metrics with the business impact of
classification errors, such as the cost of false positives (incorrectly
predicting default) and false negatives (failing to predict a
default).</li>
</ul></li>
<li><strong>Decision Thresholds:</strong>
<ul>
<li>Highlighted that different metrics may be optimal at different
decision thresholds, and the business should determine the threshold
that best aligns with its goals.</li>
</ul></li>
<li><strong>Model Interpretability:</strong>
<ul>
<li>Demonstrated how secondary metrics can aid in understanding the
model's performance in terms of business-relevant outcomes.</li>
</ul></li>
</ul>
</div>
<section id="conclusions" class="cell markdown" id="UsYKP2F7kb1C">
<h1>Conclusions</h1>
<p>In conclusion, the loan default prediction model developed in this
study effectively identifies loans at risk of default, achieving a high
AUC-ROC score of 99.7. The model's performance was further optimized by
selecting the top 10 most important features, resulting in a more
efficient and interpretable model without compromising accuracy.
Secondary metrics such as precision, recall, and F1 score were used to
evaluate the model's performance in the context of business objectives
and the costs associated with different types of classification errors.
By aligning the model's evaluation with business needs, we ensure that
it meets the specific requirements of the loan default prediction
task.</p>
</section>
<section id="future-work" class="cell markdown" id="f-6oVBjlkb1C">
<h1><strong>Future Work:</strong></h1>
<ul>
<li><strong>Data Collection and Quality:</strong>
<ul>
<li>Collect more comprehensive data with a wider range of features to
improve the model's accuracy and robustness.</li>
<li>Implement robust data cleaning and validation processes to ensure
data integrity.</li>
</ul></li>
<li><strong>Model Optimization:</strong>
<ul>
<li><p>Explore additional feature engineering techniques to extract more
relevant information from the data.</p>
<ul>
<li>Income</li>
<li>Credit score/history</li>
<li>Debt</li>
<li>Employment history</li>
<li>Purpose of loan</li>
<li>Loan-to-value ratio</li>
</ul></li>
<li><p>Experiment with different hyperparameters and model architectures
to enhance the model's performance.</p></li>
</ul></li>
<li><strong>Model Interpretability:</strong>
<ul>
<li>Develop methods to explain the model's predictions and identify the
key factors contributing to loan defaults.</li>
<li>Communicate the model's behavior and limitations effectively to
stakeholders.</li>
</ul></li>
<li><strong>Business Integration:</strong>
<ul>
<li>Integrate the model into the business's decision-making processes,
such as credit scoring and risk assessment.</li>
<li>Monitor the model's performance over time and adjust it as needed to
maintain its effectiveness.</li>
</ul></li>
</ul>
<p>monitor the model post-deployment for any signs of bias &amp;
discrimination.</p>
</section>
<div class="cell markdown" id="Jsu665wykb1C">
<p>#<em>Notebook runtime: 10 mins Time spent: 36 - 48 hours</em></p>
</div>
<div class="cell code" data-execution_count="172" id="-gOrcLe34c-Z">
<div class="sourceCode" id="cb97"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
